/*! jQuery.ajaxRetry v0.1.3 | (c) 2013 Daniel Herman | opensource.org/licenses/MIT | https://github.com/dcherman/jQuery.ajaxRetry */
!function(a){"use strict";function b(a){return a.state?"pending"!==a.state():a.isResolved()||a.isRejected()}var c="__RETRY__"+(new Date).getTime();a.ajaxPrefilter(function(d,e,f){if(!d[c]&&"undefined"!=typeof d.shouldRetry){e[c]=!0;var g,h,i=a.Deferred(),j=a.Deferred(),k={},l=0,m=function(b,c,e){var f,g=d.shouldRetry,h=typeof g;switch(h){case"number":f=g>c;break;case"boolean":f=g;break;case"function":f=g(b,c,e)}return"object"==typeof f&&"function"==typeof f.then?a.Deferred(function(a){f.then(a.resolve,function(){a.resolve(!1)})}).promise():a.when(f)};g=a.extend({},e,{success:a.noop,error:a.noop,complete:a.noop,statusCode:{}}),function n(b,c,d){(c?m(c,l++,b.type||"GET"):a.when(!0)).done(function(e){e===!0?(c?a.ajax(b):f).then(function(a,b,c){h=c.status,i.resolveWith(this,arguments),i.done(k[h]),j.resolveWith(this,[c,b])},function(a,c){var d=arguments,e=this;n(b,a,function(){h=a.status,i.rejectWith(e,d),i.fail(k[h]),j.resolveWith(e,[a,c])})}):d()})}(g),f.complete&&(f.complete=j.done,f.success=i.done,f.error=i.fail),a.extend(f,i.promise()),f.statusCode=function(a){var c;if(a)if(b(i))i.then(a[h],a[h]);else for(c in a)k[c]=[k[c],a[c]];return this}}})}(jQuery);

/*
 * @preserve FastClick: polyfill to remove click delays on browsers with touch UIs.
 *
 * @version 1.0.6
 * @codingstandard ftlabs-jsv2
 * @copyright The Financial Times Limited [All Rights Reserved]
 * @license MIT License (see LICENSE.txt)
 */
!function(){"use strict";function t(e,o){var i;if(o=o||{},this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=o.touchBoundary||10,this.layer=e,this.tapDelay=o.tapDelay||200,this.tapTimeout=o.tapTimeout||700,!t.notNeeded(e)){for(var r=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"],a=this,c=0,s=r.length;c<s;c++)a[r[c]]=u(a[r[c]],a);n&&(e.addEventListener("mouseover",this.onMouse,!0),e.addEventListener("mousedown",this.onMouse,!0),e.addEventListener("mouseup",this.onMouse,!0)),e.addEventListener("click",this.onClick,!0),e.addEventListener("touchstart",this.onTouchStart,!1),e.addEventListener("touchmove",this.onTouchMove,!1),e.addEventListener("touchend",this.onTouchEnd,!1),e.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(e.removeEventListener=function(t,n,o){var i=Node.prototype.removeEventListener;"click"===t?i.call(e,t,n.hijacked||n,o):i.call(e,t,n,o)},e.addEventListener=function(t,n,o){var i=Node.prototype.addEventListener;"click"===t?i.call(e,t,n.hijacked||(n.hijacked=function(t){t.propagationStopped||n(t)}),o):i.call(e,t,n,o)}),"function"==typeof e.onclick&&(i=e.onclick,e.addEventListener("click",function(t){i(t)},!1),e.onclick=null)}function u(t,e){return function(){return t.apply(e,arguments)}}}var e=navigator.userAgent.indexOf("Windows Phone")>=0,n=navigator.userAgent.indexOf("Android")>0&&!e,o=/iP(ad|hone|od)/.test(navigator.userAgent)&&!e,i=o&&/OS 4_\d(_\d)?/.test(navigator.userAgent),r=o&&/OS [6-7]_\d/.test(navigator.userAgent),a=navigator.userAgent.indexOf("BB10")>0;t.prototype.needsClick=function(t){switch(t.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(t.disabled)return!0;break;case"input":if(o&&"file"===t.type||t.disabled)return!0;break;case"label":case"iframe":case"video":return!0}return/\bneedsclick\b/.test(t.className)},t.prototype.needsFocus=function(t){switch(t.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!n;case"input":switch(t.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!t.disabled&&!t.readOnly;default:return/\bneedsfocus\b/.test(t.className)}},t.prototype.sendClick=function(t,e){var n,o;document.activeElement&&document.activeElement!==t&&document.activeElement.blur(),o=e.changedTouches[0],(n=document.createEvent("MouseEvents")).initMouseEvent(this.determineEventType(t),!0,!0,window,1,o.screenX,o.screenY,o.clientX,o.clientY,!1,!1,!1,!1,0,null),n.forwardedTouchEvent=!0,t.dispatchEvent(n)},t.prototype.determineEventType=function(t){return n&&"select"===t.tagName.toLowerCase()?"mousedown":"click"},t.prototype.focus=function(t){var e;o&&t.setSelectionRange&&0!==t.type.indexOf("date")&&"time"!==t.type&&"month"!==t.type&&"email"!==t.type?(e=t.value.length,t.focus(),t.setSelectionRange(e,e)):t.focus()},t.prototype.updateScrollParent=function(t){var e,n;if(!(e=t.fastClickScrollParent)||!e.contains(t)){n=t;do{if(n.scrollHeight>n.offsetHeight){e=n,t.fastClickScrollParent=n;break}n=n.parentElement}while(n)}e&&(e.fastClickLastScrollTop=e.scrollTop)},t.prototype.getTargetElementFromEventTarget=function(t){return t.nodeType===Node.TEXT_NODE?t.parentNode:t},t.prototype.onTouchStart=function(t){var e,n,r,a;if(t.timeStamp<0?(a=(new Date).getTime(),this.isTrackingClickStartFromEvent=!1):(a=t.timeStamp,this.isTrackingClickStartFromEvent=!0),t.targetTouches.length>1)return!0;if(e=this.getTargetElementFromEventTarget(t.target),n=t.targetTouches[0],o){if((r=window.getSelection()).rangeCount&&!r.isCollapsed)return!0;if(!i){if(n.identifier&&n.identifier===this.lastTouchIdentifier)return t.preventDefault(),!1;this.lastTouchIdentifier=n.identifier,this.updateScrollParent(e)}}return this.trackingClick=!0,this.trackingClickStart=a,this.targetElement=e,this.touchStartX=n.pageX,this.touchStartY=n.pageY,a-this.lastClickTime<this.tapDelay&&t.preventDefault(),!0},t.prototype.touchHasMoved=function(t){var e=t.changedTouches[0],n=this.touchBoundary;return Math.abs(e.pageX-this.touchStartX)>n||Math.abs(e.pageY-this.touchStartY)>n},t.prototype.onTouchMove=function(t){return!this.trackingClick||((this.targetElement!==this.getTargetElementFromEventTarget(t.target)||this.touchHasMoved(t))&&(this.trackingClick=!1,this.targetElement=null),!0)},t.prototype.findControl=function(t){return void 0!==t.control?t.control:t.htmlFor?document.getElementById(t.htmlFor):t.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},t.prototype.onTouchEnd=function(t){var e,a,c,s,u,l,h=this.targetElement;if(l=this.isTrackingClickStartFromEvent?t.timeStamp:(new Date).getTime(),!this.trackingClick)return!0;if(l-this.lastClickTime<this.tapDelay)return this.cancelNextClick=!0,!0;if(l-this.trackingClickStart>this.tapTimeout)return!0;if(this.cancelNextClick=!1,this.lastClickTime=l,a=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,r&&(u=t.changedTouches[0],(h=document.elementFromPoint(u.pageX-window.pageXOffset,u.pageY-window.pageYOffset)||h).fastClickScrollParent=this.targetElement.fastClickScrollParent),"label"===(c=h.tagName.toLowerCase())){if(e=this.findControl(h)){if(this.focus(h),n)return!1;h=e}}else if(this.needsFocus(h))return l-a>100||o&&window.top!==window&&"input"===c?(this.targetElement=null,!1):(this.focus(h),this.sendClick(h,t),o&&"select"===c||(this.targetElement=null,t.preventDefault()),!1);return!(!o||i||!(s=h.fastClickScrollParent)||s.fastClickLastScrollTop===s.scrollTop)||(this.needsClick(h)||(t.preventDefault(),this.sendClick(h,t)),!1)},t.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},t.prototype.onMouse=function(t){return!this.targetElement||(!!t.forwardedTouchEvent||(!t.cancelable||(!(!this.needsClick(this.targetElement)||this.cancelNextClick)||(t.stopImmediatePropagation?t.stopImmediatePropagation():t.propagationStopped=!0,t.stopPropagation(),t.preventDefault(),!1))))},t.prototype.onClick=function(t){var e;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===t.target.type&&0===t.detail||((e=this.onMouse(t))||(this.targetElement=null),e)},t.prototype.destroy=function(){var t=this.layer;n&&(t.removeEventListener("mouseover",this.onMouse,!0),t.removeEventListener("mousedown",this.onMouse,!0),t.removeEventListener("mouseup",this.onMouse,!0)),t.removeEventListener("click",this.onClick,!0),t.removeEventListener("touchstart",this.onTouchStart,!1),t.removeEventListener("touchmove",this.onTouchMove,!1),t.removeEventListener("touchend",this.onTouchEnd,!1),t.removeEventListener("touchcancel",this.onTouchCancel,!1)},t.notNeeded=function(t){var e,o,i;if(void 0===window.ontouchstart)return!0;if(o=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]){if(!n)return!0;if(e=document.querySelector("meta[name=viewport]")){if(-1!==e.content.indexOf("user-scalable=no"))return!0;if(o>31&&document.documentElement.scrollWidth<=window.outerWidth)return!0}}if(a&&(i=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/))[1]>=10&&i[2]>=3&&(e=document.querySelector("meta[name=viewport]"))){if(-1!==e.content.indexOf("user-scalable=no"))return!0;if(document.documentElement.scrollWidth<=window.outerWidth)return!0}return"none"===t.style.msTouchAction||"manipulation"===t.style.touchAction||(!!(+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]>=27&&(e=document.querySelector("meta[name=viewport]"))&&(-1!==e.content.indexOf("user-scalable=no")||document.documentElement.scrollWidth<=window.outerWidth))||("none"===t.style.touchAction||"manipulation"===t.style.touchAction))},t.attach=function(e,n){return new t(e,n)},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return t}):"undefined"!=typeof module&&module.exports?(module.exports=t.attach,module.exports.FastClick=t):window.FastClick=t}();

/*

 Licensed under the Apache License, Version 2.0 (the "License"); you may not
 use this file except in compliance with the License. You may obtain a copy
 of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 License for the specific language governing permissions and limitations under
 the License.

 Copyright (c) 2011-2014 Almende B.V.

 @author  Jos de Jong, <jos@almende.org>
 @date    2014-05-16
 @version 2.8.0
*/
"undefined"==typeof links&&(links={}),"undefined"==typeof google&&(google=void 0),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){for(var i=0,n=this.length;n>i;++i)e.call(t||this,this[i],i,this)}),links.Timeline=function(e,t){if(e){this.dom={},this.conversion={},this.eventParams={},this.groups=[],this.groupIndexes={},this.items=[],this.renderQueue={show:[],hide:[],update:[]},this.renderedItems=[],this.clusterGenerator=new links.Timeline.ClusterGenerator(this),this.currentClusters=[],this.selection=void 0,this.listeners={},this.size={actualHeight:0,axis:{characterMajorHeight:0,characterMajorWidth:0,characterMinorHeight:0,characterMinorWidth:0,height:0,labelMajorTop:0,labelMinorTop:0,line:0,lineMajorWidth:0,lineMinorHeight:0,lineMinorTop:0,lineMinorWidth:0,top:0},contentHeight:0,contentLeft:0,contentWidth:0,frameHeight:0,frameWidth:0,groupsLeft:0,groupsWidth:0,items:{top:0}},this.dom.container=e,this.options={width:"100%",height:"auto",minHeight:0,groupMinHeight:0,autoHeight:!0,eventMargin:10,eventMarginAxis:20,dragAreaWidth:10,min:void 0,max:void 0,zoomMin:10,zoomMax:31536e10,moveable:!0,zoomable:!0,selectable:!0,unselectable:!0,editable:!1,snapEvents:!0,groupChangeable:!0,timeChangeable:!0,showCurrentTime:!0,showCustomTime:!1,showMajorLabels:!0,showMinorLabels:!0,showNavigation:!1,showButtonNew:!1,groupsOnRight:!1,groupsOrder:!0,axisOnTop:!1,stackEvents:!0,animate:!0,animateZoom:!0,cluster:!1,clusterMaxItems:5,style:"box",customStackOrder:!1,locale:"en",MONTHS:["January","February","March","April","May","June","July","August","September","October","November","December"],MONTHS_SHORT:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],DAYS:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],DAYS_SHORT:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ZOOM_IN:"Zoom in",ZOOM_OUT:"Zoom out",MOVE_LEFT:"Move left",MOVE_RIGHT:"Move right",NEW:"New",CREATE_NEW_EVENT:"Create new event"},this.setOptions(t),this.clientTimeOffset=0;for(var i=this.dom;i.container.hasChildNodes();)i.container.removeChild(i.container.firstChild);this.step=new links.Timeline.StepDate,this.itemTypes={box:links.Timeline.ItemBox,range:links.Timeline.ItemRange,floatingRange:links.Timeline.ItemFloatingRange,dot:links.Timeline.ItemDot},this.data=[],this.firstDraw=!0,this.setVisibleChartRange(void 0,void 0,!1),this.render();var n=this;setTimeout(function(){n.trigger("ready")},0)}},links.Timeline.prototype.draw=function(e,t){t&&console.log("WARNING: Passing options in draw() is deprecated. Pass options to the constructur or use setOptions() instead!"),this.setOptions(t),this.options.selectable&&links.Timeline.addClassName(this.dom.frame,"timeline-selectable"),this.setData(e),t&&(t.start||t.end)?this.setVisibleChartRange(t.start,t.end):this.firstDraw&&this.setVisibleChartRangeAuto(),this.firstDraw=!1},links.Timeline.prototype.setOptions=function(e){if(e){for(var t in e)e.hasOwnProperty(t)&&(this.options[t]=e[t]);if("undefined"!=typeof links.locales&&"en"!==this.options.locale){var i=links.locales[this.options.locale];if(i)for(var n in i)i.hasOwnProperty(n)&&(this.options[n]=i[n])}void 0!=e.showButtonAdd&&(this.options.showButtonNew=e.showButtonAdd,console.log("WARNING: Option showButtonAdd is deprecated. Use showButtonNew instead")),void 0!=e.intervalMin&&(this.options.zoomMin=e.intervalMin,console.log("WARNING: Option intervalMin is deprecated. Use zoomMin instead")),void 0!=e.intervalMax&&(this.options.zoomMax=e.intervalMax,console.log("WARNING: Option intervalMax is deprecated. Use zoomMax instead")),e.scale&&e.step&&this.step.setScale(e.scale,e.step)}this.options.autoHeight="auto"===this.options.height},links.Timeline.prototype.getOptions=function(){return this.options},links.Timeline.prototype.addItemType=function(e,t){this.itemTypes[e]=t},links.Timeline.mapColumnIds=function(e){for(var t={},i=e.getNumberOfColumns(),n=!0,s=0;i>s;s++){var o=e.getColumnId(s)||e.getColumnLabel(s);t[o]=s,("start"==o||"end"==o||"content"==o||"group"==o||"className"==o||"editable"==o||"type"==o)&&(n=!1)}return n&&(t.start=0,t.end=1,t.content=2,i>3&&(t.group=3),i>4&&(t.className=4),i>5&&(t.editable=5),i>6&&(t.type=6)),t},links.Timeline.prototype.setData=function(e){this.unselectItem(),e||(e=[]),this.stackCancelAnimation(),this.clearItems(),this.data=e;var t=this.items;if(this.deleteGroups(),google&&google.visualization&&e instanceof google.visualization.DataTable)for(var i=links.Timeline.mapColumnIds(e),n=0,s=e.getNumberOfRows();s>n;n++)t.push(this.createItem({start:void 0!=i.start?e.getValue(n,i.start):void 0,end:void 0!=i.end?e.getValue(n,i.end):void 0,content:void 0!=i.content?e.getValue(n,i.content):void 0,group:void 0!=i.group?e.getValue(n,i.group):void 0,className:void 0!=i.className?e.getValue(n,i.className):void 0,editable:void 0!=i.editable?e.getValue(n,i.editable):void 0,type:void 0!=i.type?e.getValue(n,i.type):void 0}));else{if(!links.Timeline.isArray(e))throw"Unknown data type. DataTable or Array expected.";for(var n=0,s=e.length;s>n;n++){var o=e[n],a=this.createItem(o);t.push(a)}}this.options.cluster&&this.clusterGenerator.setData(this.items),this.render({animate:!1})},links.Timeline.prototype.getData=function(){return this.data},links.Timeline.prototype.updateData=function(e,t){var i,n=this.data;if(google&&google.visualization&&n instanceof google.visualization.DataTable){var s=e+1-n.getNumberOfRows();s>0&&n.addRows(s);var o=links.Timeline.mapColumnIds(n);for(i in t)if(t.hasOwnProperty(i)){var a=o[i];if(void 0==a){var r=t[i],l="string";"number"==typeof r?l="number":"boolean"==typeof r?l="boolean":r instanceof Date&&(l="datetime"),a=n.addColumn(l,i)}n.setValue(e,a,t[i])}}else{if(!links.Timeline.isArray(n))throw"Cannot update data, unknown type of data";var h=n[e];void 0==h&&(h={},n[e]=h);for(i in t)t.hasOwnProperty(i)&&(h[i]=t[i])}},links.Timeline.prototype.getItemIndex=function(e){for(var t=e,i=this.dom,n=i.items.frame,s=this.items,o=void 0;t.parentNode&&t.parentNode!==n;)t=t.parentNode;if(t.parentNode===n)for(var a=0,r=s.length;r>a;a++)if(s[a].dom===t){o=a;break}return o},links.Timeline.prototype.getClusterIndex=function(e){var t=e,i=this.dom,n=i.items.frame,s=this.clusters,o=void 0;if(this.clusters){for(;t.parentNode&&t.parentNode!==n;)t=t.parentNode;if(t.parentNode===n)for(var a=0,r=s.length;r>a;a++)if(s[a].dom===t){o=a;break}}return o},links.Timeline.prototype.getVisibleItems=function(e,t){var i=this.items,n=[];if(i)for(var s=0,o=i.length;o>s;s++){var a=i[s];a.end?e<=a.start&&a.end<=t&&n.push({row:s}):e<=a.start&&a.start<=t&&n.push({row:s})}return n},links.Timeline.prototype.setSize=function(e,t){e&&(this.options.width=e,this.dom.frame.style.width=e),t&&(this.options.height=t,this.options.autoHeight="auto"===this.options.height,"auto"!==t&&(this.dom.frame.style.height=t)),this.render({animate:!1})},links.Timeline.prototype.setVisibleChartRange=function(e,t,i){var n={};e&&t||(n=this.getDataRange(!0)),e||(t?n.min&&n.min.valueOf()<t.valueOf()?e=n.min:(e=new Date(t.valueOf()),e.setDate(e.getDate()-7)):(e=new Date,e.setDate(e.getDate()-3))),t||(n.max?t=n.max:(t=new Date(e.valueOf()),t.setDate(t.getDate()+7))),e>=t&&(t=new Date(e.valueOf()),t.setDate(t.getDate()+7));var s=this.options.min?this.options.min:void 0;void 0!=s&&e.valueOf()<s.valueOf()&&(e=new Date(s.valueOf()));var o=this.options.max?this.options.max:void 0;void 0!=o&&t.valueOf()>o.valueOf()&&(t=new Date(o.valueOf())),this.applyRange(e,t),void 0==i||1==i?this.render({animate:!1}):this.recalcConversion()},links.Timeline.prototype.setVisibleChartRangeAuto=function(){var e=this.getDataRange(!0);this.setVisibleChartRange(e.min,e.max)},links.Timeline.prototype.setVisibleChartRangeNow=function(){var e=new Date,t=this.end.valueOf()-this.start.valueOf(),i=new Date(e.valueOf()-t/2),n=new Date(i.valueOf()+t);this.setVisibleChartRange(i,n)},links.Timeline.prototype.getVisibleChartRange=function(){return{start:new Date(this.start.valueOf()),end:new Date(this.end.valueOf())}},links.Timeline.prototype.getDataRange=function(e){var t=this.items,i=void 0,n=void 0;if(t)for(var s=0,o=t.length;o>s;s++){var a=t[s],r=void 0!=a.start?a.start.valueOf():void 0,l=void 0!=a.end?a.end.valueOf():r;void 0!=r&&(i=void 0!=i?Math.min(i.valueOf(),r.valueOf()):r),void 0!=l&&(n=void 0!=n?Math.max(n.valueOf(),l.valueOf()):l)}if(i&&n&&e){var h=n-i;i-=.05*h,n+=.05*h}return{min:void 0!=i?new Date(i):void 0,max:void 0!=n?new Date(n):void 0}},links.Timeline.prototype.render=function(e){var t=(this.reflowFrame(),this.reflowAxis(),this.reflowGroups(),this.reflowItems(),this.options.animate);e&&void 0!=e.animate&&(t=e.animate),this.recalcConversion(),this.clusterItems(),this.filterItems(),this.stackItems(t),this.recalcItems();var i=this.repaint();if(i){var n=e?e.renderTimesLeft:void 0;void 0==n&&(n=5),n>0&&this.render({animate:e?e.animate:void 0,renderTimesLeft:n-1})}},links.Timeline.prototype.repaint=function(){var e=this.repaintFrame(),t=this.repaintAxis(),i=this.repaintGroups(),n=this.repaintItems();return this.repaintCurrentTime(),this.repaintCustomTime(),e||t||i||n},links.Timeline.prototype.reflowFrame=function(){var e=this.dom,t=(this.options,this.size),i=!1,n=e.frame?e.frame.offsetWidth:0,s=e.frame?e.frame.clientHeight:0;return i=i||t.frameWidth!==n,i=i||t.frameHeight!==s,t.frameWidth=n,t.frameHeight=s,i},links.Timeline.prototype.repaintFrame=function(){var e=!1,t=this.dom,i=this.options,n=this.size;t.frame||(t.frame=document.createElement("DIV"),t.frame.className="timeline-frame ui-widget ui-widget-content ui-corner-all",t.container.appendChild(t.frame),e=!0);var s=i.autoHeight?n.actualHeight+"px":i.height||"100%",o=i.width||"100%";if(e=e||t.frame.style.height!=s,e=e||t.frame.style.width!=o,t.frame.style.height=s,t.frame.style.width=o,!t.content){t.content=document.createElement("DIV"),t.content.className="timeline-content",t.frame.appendChild(t.content);var a=document.createElement("DIV");a.style.position="absolute",a.style.left="0px",a.style.top="0px",a.style.height="100%",a.style.width="0px",t.content.appendChild(a),t.contentTimelines=a;var r=this.eventParams,l=this;r.onMouseDown||(r.onMouseDown=function(e){l.onMouseDown(e)},links.Timeline.addEventListener(t.content,"mousedown",r.onMouseDown)),r.onTouchStart||(r.onTouchStart=function(e){l.onTouchStart(e)},links.Timeline.addEventListener(t.content,"touchstart",r.onTouchStart)),r.onMouseWheel||(r.onMouseWheel=function(e){l.onMouseWheel(e)},links.Timeline.addEventListener(t.content,"mousewheel",r.onMouseWheel)),r.onDblClick||(r.onDblClick=function(e){l.onDblClick(e)},links.Timeline.addEventListener(t.content,"dblclick",r.onDblClick)),e=!0}return t.content.style.left=n.contentLeft+"px",t.content.style.top="0px",t.content.style.width=n.contentWidth+"px",t.content.style.height=n.frameHeight+"px",this.repaintNavigation(),e},links.Timeline.prototype.reflowAxis=function(){var e=!1,t=this.dom,i=this.options,n=this.size,s=t.axis,o=s&&s.characterMinor?s.characterMinor.clientWidth:0,a=s&&s.characterMinor?s.characterMinor.clientHeight:0,r=s&&s.characterMajor?s.characterMajor.clientWidth:0,l=s&&s.characterMajor?s.characterMajor.clientHeight:0,h=(i.showMinorLabels?a:0)+(i.showMajorLabels?l:0),m=i.axisOnTop?0:n.frameHeight-h,p=i.axisOnTop?h:m;e=e||n.axis.top!==m,e=e||n.axis.line!==p,e=e||n.axis.height!==h,n.axis.top=m,n.axis.line=p,n.axis.height=h,n.axis.labelMajorTop=i.axisOnTop?0:p+(i.showMinorLabels?a:0),n.axis.labelMinorTop=i.axisOnTop?i.showMajorLabels?l:0:p,n.axis.lineMinorTop=i.axisOnTop?n.axis.labelMinorTop:0,n.axis.lineMinorHeight=i.showMajorLabels?n.frameHeight-l:n.frameHeight,n.axis.lineMinorWidth=s&&s.minorLines&&s.minorLines.length?s.minorLines[0].offsetWidth:1,n.axis.lineMajorWidth=s&&s.majorLines&&s.majorLines.length?s.majorLines[0].offsetWidth:1,e=e||n.axis.characterMinorWidth!==o,e=e||n.axis.characterMinorHeight!==a,e=e||n.axis.characterMajorWidth!==r,e=e||n.axis.characterMajorHeight!==l,n.axis.characterMinorWidth=o,n.axis.characterMinorHeight=a,n.axis.characterMajorWidth=r,n.axis.characterMajorHeight=l;var u=Math.max(n.frameHeight-h,0);return n.contentLeft=i.groupsOnRight?0:n.groupsWidth,n.contentWidth=Math.max(n.frameWidth-n.groupsWidth,0),n.contentHeight=u,e},links.Timeline.prototype.repaintAxis=function(){var e=!1,t=this.dom,i=this.options,n=this.size,s=this.step,o=t.axis;o||(o={},t.axis=o),n.axis.properties||(n.axis.properties={}),o.minorTexts||(o.minorTexts=[]),o.minorLines||(o.minorLines=[]),o.majorTexts||(o.majorTexts=[]),o.majorLines||(o.majorLines=[]),o.frame||(o.frame=document.createElement("DIV"),o.frame.style.position="absolute",o.frame.style.left="0px",o.frame.style.top="0px",t.content.appendChild(o.frame)),t.content.removeChild(o.frame),o.frame.style.width=n.contentWidth+"px",o.frame.style.height=n.axis.height+"px";var a=this.screenToTime(0),r=this.screenToTime(n.contentWidth);n.axis.characterMinorWidth&&(this.minimumStep=this.screenToTime(6*n.axis.characterMinorWidth)-this.screenToTime(0),s.setRange(a,r,this.minimumStep));var l=this.repaintAxisCharacters();e=e||l,this.repaintAxisStartOverwriting(),s.start();for(var h=void 0,m=0;!s.end()&&1e3>m;){m++;var p=s.getCurrent(),u=this.timeToScreen(p),d=s.isMajor();i.showMinorLabels&&this.repaintAxisMinorText(u,s.getLabelMinor(i)),d&&i.showMajorLabels?(u>0&&(void 0==h&&(h=u),this.repaintAxisMajorText(u,s.getLabelMajor(i))),this.repaintAxisMajorLine(u)):this.repaintAxisMinorLine(u),s.next()}if(i.showMajorLabels){var c=this.screenToTime(0),g=this.step.getLabelMajor(i,c),f=g.length*n.axis.characterMajorWidth+10;(void 0==h||h>f)&&this.repaintAxisMajorText(0,g,c)}return this.repaintAxisEndOverwriting(),this.repaintAxisHorizontal(),t.content.insertBefore(o.frame,t.content.firstChild),e},links.Timeline.prototype.repaintAxisCharacters=function(){var e,t=!1,i=this.dom,n=i.axis;if(!n.characterMinor){e=document.createTextNode("0");var s=document.createElement("DIV");s.className="timeline-axis-text timeline-axis-text-minor",s.appendChild(e),s.style.position="absolute",s.style.visibility="hidden",s.style.paddingLeft="0px",s.style.paddingRight="0px",n.frame.appendChild(s),n.characterMinor=s,t=!0}if(!n.characterMajor){e=document.createTextNode("0");var o=document.createElement("DIV");o.className="timeline-axis-text timeline-axis-text-major",o.appendChild(e),o.style.position="absolute",o.style.visibility="hidden",o.style.paddingLeft="0px",o.style.paddingRight="0px",n.frame.appendChild(o),n.characterMajor=o,t=!0}return t},links.Timeline.prototype.repaintAxisStartOverwriting=function(){var e=this.size.axis.properties;e.minorTextNum=0,e.minorLineNum=0,e.majorTextNum=0,e.majorLineNum=0},links.Timeline.prototype.repaintAxisEndOverwriting=function(){var e,t=this.dom,i=this.size.axis.properties,n=this.dom.axis.frame,s=t.axis.minorTexts;for(e=i.minorTextNum;s.length>e;){var o=s[e];n.removeChild(o),s.splice(e,1)}var a=t.axis.minorLines;for(e=i.minorLineNum;a.length>e;){var r=a[e];n.removeChild(r),a.splice(e,1)}var l=t.axis.majorTexts;for(e=i.majorTextNum;l.length>e;){var h=l[e];n.removeChild(h),l.splice(e,1)}var m=t.axis.majorLines;for(e=i.majorLineNum;m.length>e;){var p=m[e];n.removeChild(p),m.splice(e,1)}},links.Timeline.prototype.repaintAxisHorizontal=function(){var e=this.dom.axis,t=this.size,i=this.options,n=i.showMinorLabels||i.showMajorLabels;if(n){if(!e.backgroundLine){var s=document.createElement("DIV");s.className="timeline-axis",s.style.position="absolute",s.style.left="0px",s.style.width="100%",s.style.border="none",e.frame.insertBefore(s,e.frame.firstChild),e.backgroundLine=s}e.backgroundLine&&(e.backgroundLine.style.top=t.axis.top+"px",e.backgroundLine.style.height=t.axis.height+"px")}else e.backgroundLine&&(e.frame.removeChild(e.backgroundLine),delete e.backgroundLine);if(n){if(e.line){var o=e.frame.removeChild(e.line);e.frame.appendChild(o)}else{var o=document.createElement("DIV");o.className="timeline-axis",o.style.position="absolute",o.style.left="0px",o.style.width="100%",o.style.height="0px",e.frame.appendChild(o),e.line=o}e.line.style.top=t.axis.line+"px"}else e.line&&e.line.parentElement&&(e.frame.removeChild(e.line),delete e.line)},links.Timeline.prototype.repaintAxisMinorText=function(e,t){var i,n=this.size,s=this.dom,o=n.axis.properties,a=s.axis.frame,r=s.axis.minorTexts,l=o.minorTextNum;if(l<r.length)i=r[l];else{var h=document.createTextNode("");i=document.createElement("DIV"),i.appendChild(h),i.className="timeline-axis-text timeline-axis-text-minor",i.style.position="absolute",a.appendChild(i),r.push(i)}i.childNodes[0].nodeValue=t,i.style.left=e+"px",i.style.top=n.axis.labelMinorTop+"px",o.minorTextNum++},links.Timeline.prototype.repaintAxisMinorLine=function(e){var t,i=this.size.axis,n=this.dom,s=i.properties,o=n.axis.frame,a=n.axis.minorLines,r=s.minorLineNum;r<a.length?t=a[r]:(t=document.createElement("DIV"),t.className="timeline-axis-grid timeline-axis-grid-minor",t.style.position="absolute",t.style.width="0px",o.appendChild(t),a.push(t)),t.style.top=i.lineMinorTop+"px",t.style.height=i.lineMinorHeight+"px",t.style.left=e-i.lineMinorWidth/2+"px",s.minorLineNum++},links.Timeline.prototype.repaintAxisMajorText=function(e,t){var i,n=this.size,s=n.axis.properties,o=this.dom.axis.frame,a=this.dom.axis.majorTexts,r=s.majorTextNum;if(r<a.length)i=a[r];else{var l=document.createTextNode(t);i=document.createElement("DIV"),i.className="timeline-axis-text timeline-axis-text-major",i.appendChild(l),i.style.position="absolute",i.style.top="0px",o.appendChild(i),a.push(i)}i.childNodes[0].nodeValue=t,i.style.top=n.axis.labelMajorTop+"px",i.style.left=e+"px",s.majorTextNum++},links.Timeline.prototype.repaintAxisMajorLine=function(e){var t,i=this.size,n=i.axis.properties,s=this.size.axis,o=this.dom.axis.frame,a=this.dom.axis.majorLines,r=n.majorLineNum;r<a.length?t=a[r]:(t=document.createElement("DIV"),t.className="timeline-axis-grid timeline-axis-grid-major",t.style.position="absolute",t.style.top="0px",t.style.width="0px",o.appendChild(t),a.push(t)),t.style.left=e-s.lineMajorWidth/2+"px",t.style.height=i.frameHeight+"px",n.majorLineNum++},links.Timeline.prototype.reflowItems=function(){var e,t,i,n=!1,s=this.groups,o=this.renderedItems;for(s&&s.forEach(function(e){e.itemsHeight=0}),e=0,t=o.length;t>e;e++){var a=o[e],r=a.dom;if(i=a.group,r){var l=r?r.clientWidth:0,h=r?r.clientHeight:0;n=n||a.width!=l,n=n||a.height!=h,a.width=l,a.height=h,a.reflow()}i&&(i.itemsHeight=Math.max(this.options.groupMinHeight,i.itemsHeight?Math.max(i.itemsHeight,a.height):a.height))}return n},links.Timeline.prototype.recalcItems=function(){var e,t,i,n,s,o,a=!1,r=this.groups,l=this.size,h=this.options,m=this.renderedItems,p=0;if(0==r.length){if(h.autoHeight||h.cluster){var u=0,d=0;if(this.stack&&this.stack.finalItems)for(s=this.stack.finalItems,n=s[0],n&&n.top&&(u=n.top,d=n.top+n.height),e=1,t=s.length;t>e;e++)n=s[e],u=Math.min(u,n.top),d=Math.max(d,n.top+n.height);else for(i=m[0],i&&i.top&&(u=i.top,d=i.top+i.height),e=1,t=m.length;t>e;e++)i=m[e],i.top&&(u=Math.min(u,i.top),d=Math.max(d,i.top+i.height));if(p=d-u+2*h.eventMarginAxis+l.axis.height,p<h.minHeight&&(p=h.minHeight),l.actualHeight!=p&&h.autoHeight&&!h.axisOnTop){var c=p-l.actualHeight;if(this.stack&&this.stack.finalItems)for(s=this.stack.finalItems,e=0,t=s.length;t>e;e++)s[e].top+=c,s[e].item.top+=c;else for(e=0,t=m.length;t>e;e++)m[e].top+=c}}}else{for(p=l.axis.height+2*h.eventMarginAxis,e=0,t=r.length;t>e;e++){o=r[e];var g=o.itemsHeight;a=a||g!=o.height,o.height=Math.max(g,h.groupMinHeight),p+=r[e].height+h.eventMargin}var f=h.eventMargin,v=h.axisOnTop?h.eventMarginAxis+f/2:l.contentHeight-h.eventMarginAxis+f/2,T=l.axis.height;for(e=0,t=r.length;t>e;e++)o=r[e],h.axisOnTop?(o.top=v+T,o.labelTop=v+T+(o.height-o.labelHeight)/2,o.lineTop=v+T+o.height+f/2,v+=o.height+f):(v-=o.height+f,o.top=v,o.labelTop=v+(o.height-o.labelHeight)/2,o.lineTop=v-f/2);a=!0}return p<h.minHeight&&(p=h.minHeight),a=a||p!=l.actualHeight,l.actualHeight=p,a},links.Timeline.prototype.clearItems=function(){var e=this.renderQueue.hide;this.renderedItems.forEach(function(t){e.push(t)}),this.clusterGenerator.clear(),this.items=[]},links.Timeline.prototype.repaintItems=function(){var e,t,i=!1,n=this.dom,s=this.size,o=this,a=this.renderedItems;n.items||(n.items={});var r=n.items.frame;r||(r=document.createElement("DIV"),r.style.position="relative",n.content.appendChild(r),n.items.frame=r),r.style.left="0px",r.style.top=s.items.top+"px",r.style.height="0px",n.content.removeChild(r);var l=this.renderQueue,h=[];for(i=i||l.show.length>0||l.update.length>0||l.hide.length>0;e=l.show.shift();)e.showDOM(r),e.getImageUrls(h),a.push(e);for(;e=l.update.shift();)e.updateDOM(r),e.getImageUrls(h),t=this.renderedItems.indexOf(e),-1==t&&a.push(e);for(;e=l.hide.shift();)e.hideDOM(r),t=this.renderedItems.indexOf(e),-1!=t&&a.splice(t,1);if(a.forEach(function(e){e.updatePosition(o)}),this.repaintDeleteButton(),this.repaintDragAreas(),n.content.appendChild(r),h.length){var m=function(){o.render()},p=!1;links.imageloader.loadAll(h,m,p)}return i},links.Timeline.prototype.reflowGroups=function(){for(var e=!1,t=this.options,i=this.size,n=this.dom,s=0,o=this.groups,a=this.dom.groups?this.dom.groups.labels:[],r=0,l=o.length;l>r;r++){var h=o[r],m=a[r];h.labelWidth=m?m.clientWidth:0,h.labelHeight=m?m.clientHeight:0,h.width=h.labelWidth,s=Math.max(s,h.width)}void 0!==t.groupsWidth&&(s=n.groups.frame?n.groups.frame.clientWidth:0),s+=1;var p=t.groupsOnRight?i.frameWidth-s:0;return e=e||i.groupsWidth!==s,e=e||i.groupsLeft!==p,i.groupsWidth=s,i.groupsLeft=p,e},links.Timeline.prototype.repaintGroups=function(){var e=this.dom,t=this,i=this.options,n=this.size,s=this.groups;void 0===e.groups&&(e.groups={});var o=e.groups.labels;o||(o=[],e.groups.labels=o);var a=e.groups.labelLines;a||(a=[],e.groups.labelLines=a);var r=e.groups.itemLines;r||(r=[],e.groups.itemLines=r);var l=e.groups.frame;l||(l=document.createElement("DIV"),l.className="timeline-groups-axis",l.style.position="absolute",l.style.overflow="hidden",l.style.top="0px",l.style.height="100%",e.frame.appendChild(l),e.groups.frame=l),l.style.left=n.groupsLeft+"px",l.style.width=void 0!==i.groupsWidth?i.groupsWidth:n.groupsWidth+"px",l.style.display=0==s.length?"none":"";for(var h=o.length,m=s.length,p=0,u=Math.min(h,m);u>p;p++){var d=s[p],c=o[p];c.innerHTML=this.getGroupName(d),c.style.display=""}for(var p=h;m>p;p++){var d=s[p],c=document.createElement("DIV");c.className="timeline-groups-text",c.style.position="absolute",void 0===i.groupsWidth&&(c.style.whiteSpace="nowrap"),c.innerHTML=this.getGroupName(d),l.appendChild(c),o[p]=c;var g=document.createElement("DIV");g.className="timeline-axis-grid timeline-axis-grid-minor",g.style.position="absolute",g.style.left="0px",g.style.width="100%",g.style.height="0px",g.style.borderTopStyle="solid",l.appendChild(g),a[p]=g;var f=document.createElement("DIV");f.className="timeline-axis-grid timeline-axis-grid-minor",f.style.position="absolute",f.style.left="0px",f.style.width="100%",f.style.height="0px",f.style.borderTopStyle="solid",e.content.insertBefore(f,e.content.firstChild),r[p]=f}for(var p=m;h>p;p++){var c=o[p],g=a[p],f=r[p];l.removeChild(c),l.removeChild(g),e.content.removeChild(f)}o.splice(m,h-m),a.splice(m,h-m),r.splice(m,h-m),links.Timeline.addClassName(l,i.groupsOnRight?"timeline-groups-axis-onright":"timeline-groups-axis-onleft");for(var p=0,u=s.length;u>p;p++){var d=s[p],c=o[p],g=a[p],f=r[p];c.style.top=d.labelTop+"px",g.style.top=d.lineTop+"px",f.style.top=d.lineTop+"px",f.style.width=n.contentWidth+"px"}if(!e.groups.background){var v=document.createElement("DIV");v.className="timeline-axis",v.style.position="absolute",v.style.left="0px",v.style.width="100%",v.style.border="none",l.appendChild(v),e.groups.background=v}if(e.groups.background.style.top=n.axis.top+"px",e.groups.background.style.height=n.axis.height+"px",!e.groups.line){var T=document.createElement("DIV");T.className="timeline-axis",T.style.position="absolute",T.style.left="0px",T.style.width="100%",T.style.height="0px",l.appendChild(T),e.groups.line=T}if(e.groups.line.style.top=n.axis.line+"px",e.groups.frame&&s.length){var k=[];if(links.imageloader.filterImageUrls(e.groups.frame,k),k.length){var y=function(){t.render()},D=!1;links.imageloader.loadAll(k,y,D)}}},links.Timeline.prototype.repaintCurrentTime=function(){var e=this.options,t=this.dom,i=this.size;if(!e.showCurrentTime)return void(t.currentTime&&(t.contentTimelines.removeChild(t.currentTime),delete t.currentTime));if(!t.currentTime){var n=document.createElement("DIV");n.className="timeline-currenttime",n.style.position="absolute",n.style.top="0px",n.style.height="100%",t.contentTimelines.appendChild(n),t.currentTime=n}var s=new Date,o=new Date(s.valueOf()+this.clientTimeOffset),a=this.timeToScreen(o),r=a>-i.contentWidth&&a<2*i.contentWidth;t.currentTime.style.display=r?"":"none",t.currentTime.style.left=a+"px",t.currentTime.title="Current time: "+o,void 0!=this.currentTimeTimer&&(clearTimeout(this.currentTimeTimer),delete this.currentTimeTimer);var l=this,h=function(){l.repaintCurrentTime()},m=1/this.conversion.factor/2;30>m&&(m=30),this.currentTimeTimer=setTimeout(h,m)},links.Timeline.prototype.repaintCustomTime=function(){var e=this.options,t=this.dom,i=this.size;if(!e.showCustomTime)return void(t.customTime&&(t.contentTimelines.removeChild(t.customTime),delete t.customTime));if(!t.customTime){var n=document.createElement("DIV");n.className="timeline-customtime",n.style.position="absolute",n.style.top="0px",n.style.height="100%";var s=document.createElement("DIV");s.style.position="relative",s.style.top="0px",s.style.left="-10px",s.style.height="100%",s.style.width="20px",n.appendChild(s),t.contentTimelines.appendChild(n),t.customTime=n,this.customTime=new Date}var o=this.timeToScreen(this.customTime),a=o>-i.contentWidth&&o<2*i.contentWidth;t.customTime.style.display=a?"":"none",t.customTime.style.left=o+"px",t.customTime.title="Time: "+this.customTime},links.Timeline.prototype.repaintDeleteButton=function(){var e=this.dom,t=e.items.frame,i=e.items.deleteButton;i||(i=document.createElement("DIV"),i.className="timeline-navigation-delete",i.style.position="absolute",t.appendChild(i),e.items.deleteButton=i);var n=this.selection&&void 0!==this.selection.index?this.selection.index:-1,s=this.selection&&void 0!==this.selection.index?this.items[n]:void 0;if(s&&s.rendered&&this.isEditable(s)){var o=s.getRight(this),a=s.top;i.style.left=o+"px",i.style.top=a+"px",i.style.display="",t.removeChild(i),t.appendChild(i)}else i.style.display="none"},links.Timeline.prototype.repaintDragAreas=function(){var e=this.options,t=this.dom,i=this.dom.items.frame,n=t.items.dragLeft;n||(n=document.createElement("DIV"),n.className="timeline-event-range-drag-left",n.style.position="absolute",i.appendChild(n),t.items.dragLeft=n);var s=t.items.dragRight;s||(s=document.createElement("DIV"),s.className="timeline-event-range-drag-right",s.style.position="absolute",i.appendChild(s),t.items.dragRight=s);var o=this.selection&&void 0!==this.selection.index?this.selection.index:-1,a=this.selection&&void 0!==this.selection.index?this.items[o]:void 0;if(a&&a.rendered&&this.isEditable(a)&&(a instanceof links.Timeline.ItemRange||a instanceof links.Timeline.ItemFloatingRange)){var r=a.getLeft(this),l=a.getRight(this),h=a.top,m=a.height;n.style.left=r+"px",n.style.top=h+"px",n.style.width=e.dragAreaWidth+"px",n.style.height=m+"px",n.style.display="",i.removeChild(n),i.appendChild(n),s.style.left=l-e.dragAreaWidth+"px",s.style.top=h+"px",s.style.width=e.dragAreaWidth+"px",s.style.height=m+"px",s.style.display="",i.removeChild(s),i.appendChild(s)}else n.style.display="none",s.style.display="none"},links.Timeline.prototype.repaintNavigation=function(){var e=this,t=this.options,i=this.dom,n=i.frame,s=i.navBar;if(!s){var o=t.showButtonNew&&t.editable,a=t.showNavigation&&(t.zoomable||t.moveable);if((a||o)&&(s=document.createElement("DIV"),s.style.position="absolute",s.className="timeline-navigation ui-widget ui-state-highlight ui-corner-all",t.groupsOnRight?s.style.left="10px":s.style.right="10px",t.axisOnTop?s.style.bottom="10px":s.style.top="10px",i.navBar=s,n.appendChild(s)),o){s.addButton=document.createElement("DIV"),s.addButton.className="timeline-navigation-new",s.addButton.title=t.CREATE_NEW_EVENT;var r=document.createElement("SPAN");r.className="ui-icon ui-icon-circle-plus",s.addButton.appendChild(r);var l=function(i){links.Timeline.preventDefault(i),links.Timeline.stopPropagation(i);var n=e.size.contentWidth,s=n/2,o=e.screenToTime(s);t.snapEvents&&e.step.snap(o);var a=t.NEW,r=e.groups.length?e.groups[0].content:void 0,l=!0;e.addItem({start:o,content:a,group:r},l);var h=e.items.length-1;e.selectItem(h),e.applyAdd=!0,e.trigger("add"),e.applyAdd?(e.render({animate:!1}),e.selectItem(h)):e.deleteItem(h)};links.Timeline.addEventListener(s.addButton,"mousedown",l),s.appendChild(s.addButton)}if(o&&a&&links.Timeline.addClassName(s.addButton,"timeline-navigation-new-line"),a){if(t.zoomable){s.zoomInButton=document.createElement("DIV"),s.zoomInButton.className="timeline-navigation-zoom-in",s.zoomInButton.title=this.options.ZOOM_IN;var h=document.createElement("SPAN");h.className="ui-icon ui-icon-circle-zoomin",s.zoomInButton.appendChild(h);var m=function(t){links.Timeline.preventDefault(t),links.Timeline.stopPropagation(t),e.zoom(.4),e.trigger("rangechange"),e.trigger("rangechanged")};links.Timeline.addEventListener(s.zoomInButton,"mousedown",m),s.appendChild(s.zoomInButton),s.zoomOutButton=document.createElement("DIV"),s.zoomOutButton.className="timeline-navigation-zoom-out",s.zoomOutButton.title=this.options.ZOOM_OUT;var p=document.createElement("SPAN");p.className="ui-icon ui-icon-circle-zoomout",s.zoomOutButton.appendChild(p);var u=function(t){links.Timeline.preventDefault(t),links.Timeline.stopPropagation(t),e.zoom(-.4),e.trigger("rangechange"),e.trigger("rangechanged")};links.Timeline.addEventListener(s.zoomOutButton,"mousedown",u),s.appendChild(s.zoomOutButton)}if(t.moveable){s.moveLeftButton=document.createElement("DIV"),s.moveLeftButton.className="timeline-navigation-move-left",s.moveLeftButton.title=this.options.MOVE_LEFT;var d=document.createElement("SPAN");d.className="ui-icon ui-icon-circle-arrow-w",s.moveLeftButton.appendChild(d);var c=function(t){links.Timeline.preventDefault(t),links.Timeline.stopPropagation(t),e.move(-.2),e.trigger("rangechange"),e.trigger("rangechanged")};links.Timeline.addEventListener(s.moveLeftButton,"mousedown",c),s.appendChild(s.moveLeftButton),s.moveRightButton=document.createElement("DIV"),s.moveRightButton.className="timeline-navigation-move-right",s.moveRightButton.title=this.options.MOVE_RIGHT;var g=document.createElement("SPAN");g.className="ui-icon ui-icon-circle-arrow-e",s.moveRightButton.appendChild(g);var f=function(t){links.Timeline.preventDefault(t),links.Timeline.stopPropagation(t),e.move(.2),e.trigger("rangechange"),e.trigger("rangechanged")};links.Timeline.addEventListener(s.moveRightButton,"mousedown",f),s.appendChild(s.moveRightButton)}}}},links.Timeline.prototype.setCurrentTime=function(e){var t=new Date;this.clientTimeOffset=e.valueOf()-t.valueOf(),this.repaintCurrentTime()},links.Timeline.prototype.getCurrentTime=function(){var e=new Date;return new Date(e.valueOf()+this.clientTimeOffset)},links.Timeline.prototype.setCustomTime=function(e){this.customTime=new Date(e.valueOf()),this.repaintCustomTime()},links.Timeline.prototype.getCustomTime=function(){return new Date(this.customTime.valueOf())},links.Timeline.prototype.setScale=function(e,t){this.step.setScale(e,t),this.render()},links.Timeline.prototype.setAutoScale=function(e){this.step.setAutoScale(e),this.render()},links.Timeline.prototype.redraw=function(){this.setData(this.data)},links.Timeline.prototype.checkResize=function(){this.render()},links.Timeline.prototype.isEditable=function(e){return e?void 0!=e.editable?e.editable:this.options.editable:!1},links.Timeline.prototype.recalcConversion=function(){this.conversion.offset=this.start.valueOf(),this.conversion.factor=this.size.contentWidth/(this.end.valueOf()-this.start.valueOf())},links.Timeline.prototype.screenToTime=function(e){var t=this.conversion;return new Date(e/t.factor+t.offset)},links.Timeline.prototype.timeToScreen=function(e){var t=this.conversion;return(e.valueOf()-t.offset)*t.factor},links.Timeline.prototype.onTouchStart=function(e){var t=this.eventParams,i=this;if(!t.touchDown){t.touchDown=!0,t.zoomed=!1,this.onMouseDown(e),t.onTouchMove||(t.onTouchMove=function(e){i.onTouchMove(e)},links.Timeline.addEventListener(document,"touchmove",t.onTouchMove)),t.onTouchEnd||(t.onTouchEnd=function(e){i.onTouchEnd(e)},links.Timeline.addEventListener(document,"touchend",t.onTouchEnd));var n=links.Timeline.getTarget(e),s=this.getItemIndex(n);t.doubleTapStartPrev=t.doubleTapStart,t.doubleTapStart=(new Date).valueOf(),t.doubleTapItemPrev=t.doubleTapItem,t.doubleTapItem=s,links.Timeline.preventDefault(e)}},links.Timeline.prototype.onTouchMove=function(e){var t=this.eventParams;if(e.scale&&1!==e.scale&&(t.zoomed=!0),t.zoomed){if(this.options.zoomable){t.zoomed=!0;var i=e.scale,n=t.end.valueOf()-t.start.valueOf(),s=n/i,o=s-n,a=new Date(parseInt(t.start.valueOf()-o/2)),r=new Date(parseInt(t.end.valueOf()+o/2));this.setVisibleChartRange(a,r),this.trigger("rangechange")}}else this.onMouseMove(e);links.Timeline.preventDefault(e)},links.Timeline.prototype.onTouchEnd=function(e){var t=this.eventParams,i=this;t.touchDown=!1,t.zoomed&&this.trigger("rangechanged"),t.onTouchMove&&(links.Timeline.removeEventListener(document,"touchmove",t.onTouchMove),delete t.onTouchMove),t.onTouchEnd&&(links.Timeline.removeEventListener(document,"touchend",t.onTouchEnd),delete t.onTouchEnd),this.onMouseUp(e);{var n=500,s=(new Date).valueOf(),o=links.Timeline.getTarget(e);this.getItemIndex(o)}t.doubleTapStartPrev&&s-t.doubleTapStartPrev<n&&t.doubleTapItem==t.doubleTapItemPrev&&(t.touchDown=!0,i.onDblClick(e),t.touchDown=!1),links.Timeline.preventDefault(e)},links.Timeline.prototype.onMouseDown=function(e){e=e||window.event;var t=this.eventParams,i=this.options,n=this.dom,s=e.which?1==e.which:1==e.button;if(s||t.touchDown){t.mouseX=links.Timeline.getPageX(e),t.mouseY=links.Timeline.getPageY(e),t.frameLeft=links.Timeline.getAbsoluteLeft(this.dom.content),t.frameTop=links.Timeline.getAbsoluteTop(this.dom.content),t.previousLeft=0,t.previousOffset=0,t.moved=!1,t.start=new Date(this.start.valueOf()),t.end=new Date(this.end.valueOf()),t.target=links.Timeline.getTarget(e);var o=n.items&&n.items.dragLeft?n.items.dragLeft:void 0,a=n.items&&n.items.dragRight?n.items.dragRight:void 0;if(t.itemDragLeft=t.target===o,t.itemDragRight=t.target===a,t.itemDragLeft||t.itemDragRight?(t.itemIndex=this.selection&&void 0!==this.selection.index?this.selection.index:void 0,delete t.clusterIndex):(t.itemIndex=this.getItemIndex(t.target),t.clusterIndex=this.getClusterIndex(t.target)),t.customTime=t.target===n.customTime||t.target.parentNode===n.customTime?this.customTime:void 0,t.addItem=i.editable&&e.ctrlKey,t.addItem){var r=t.mouseX-t.frameLeft,l=t.mouseY-t.frameTop,h=this.screenToTime(r);i.snapEvents&&this.step.snap(h);var m=new Date(h.valueOf()),p=i.NEW,u=this.getGroupFromHeight(l);this.addItem({start:h,end:m,content:p,group:this.getGroupName(u)}),t.itemIndex=this.items.length-1,delete t.clusterIndex,this.selectItem(t.itemIndex),t.itemDragRight=!0}var d=this.items[t.itemIndex],c=this.isSelected(t.itemIndex);if(t.editItem=c&&this.isEditable(d),t.editItem?(t.itemStart=d.start,t.itemEnd=d.end,t.itemGroup=d.group,t.itemLeft=d.getLeft(this),t.itemRight=d.getRight(this)):this.dom.frame.style.cursor="move",!t.touchDown){var g=this;t.onMouseMove||(t.onMouseMove=function(e){g.onMouseMove(e)},links.Timeline.addEventListener(document,"mousemove",t.onMouseMove)),t.onMouseUp||(t.onMouseUp=function(e){g.onMouseUp(e)},links.Timeline.addEventListener(document,"mouseup",t.onMouseUp)),links.Timeline.preventDefault(e)}}},links.Timeline.prototype.onMouseMove=function(e){e=e||window.event;var t=this.eventParams,i=this.size,n=this.dom,s=this.options,o=links.Timeline.getPageX(e),a=links.Timeline.getPageY(e);void 0==t.mouseX&&(t.mouseX=o),void 0==t.mouseY&&(t.mouseY=a);var r=o-t.mouseX,l=a-t.mouseY;if(Math.abs(l)>=1&&(newy=$.mobile.window.scrollTop(),$.mobile.window.scrollTop(newy-l)),Math.abs(r)>=1&&(t.moved=!0),t.customTime){var h=this.timeToScreen(t.customTime),m=h+r;this.customTime=this.screenToTime(m),this.repaintCustomTime(),this.trigger("timechange")}else if(t.editItem){var p,u,d=this.items[t.itemIndex];t.itemDragLeft&&s.timeChangeable?(p=t.itemLeft+r,u=t.itemRight,d.start=this.screenToTime(p),s.snapEvents&&(this.step.snap(d.start),p=this.timeToScreen(d.start)),p>u&&(p=u,d.start=this.screenToTime(p)),this.trigger("change")):t.itemDragRight&&s.timeChangeable?(p=t.itemLeft,u=t.itemRight+r,d.end=this.screenToTime(u),s.snapEvents&&(this.step.snap(d.end),u=this.timeToScreen(d.end)),p>u&&(u=p,d.end=this.screenToTime(u)),this.trigger("change")):s.timeChangeable&&(p=t.itemLeft+r,d.start=this.screenToTime(p),s.snapEvents&&(this.step.snap(d.start),p=this.timeToScreen(d.start)),d.end&&(u=p+(t.itemRight-t.itemLeft),d.end=this.screenToTime(u)),this.trigger("change")),d.setPosition(p,u);var c=t.itemDragLeft||t.itemDragRight;if(this.groups.length&&!c){var g=a-t.frameTop,f=this.getGroupFromHeight(g);if(s.groupsChangeable&&d.group!==f){var v=this.items.indexOf(d);this.changeItem(v,{group:this.getGroupName(f)})}else this.repaintDeleteButton(),this.repaintDragAreas()}else this.render()}else if(s.moveable){var T=t.end.valueOf()-t.start.valueOf(),k=Math.round(-r/i.contentWidth*T),y=new Date(t.start.valueOf()+k),D=new Date(t.end.valueOf()+k);this.applyRange(y,D);var x=this.start.valueOf()-y.valueOf();x&&(k+=x),this.recalcConversion();var M=t.previousLeft||0,S=parseFloat(n.items.frame.style.left)||0,C=t.previousOffset||0,I=C+(S-M),E=-k/T*i.contentWidth+I;n.items.frame.style.left=E+"px",t.previousOffset=I,t.previousLeft=parseFloat(n.items.frame.style.left)||E,this.repaintCurrentTime(),this.repaintCustomTime(),this.repaintAxis(),this.trigger("rangechange")}links.Timeline.preventDefault(e)},links.Timeline.prototype.onMouseUp=function(e){var t=this.eventParams,i=this.options;if(e=e||window.event,this.dom.frame.style.cursor="auto",t.onMouseMove&&(links.Timeline.removeEventListener(document,"mousemove",t.onMouseMove),delete t.onMouseMove),t.onMouseUp&&(links.Timeline.removeEventListener(document,"mouseup",t.onMouseUp),delete t.onMouseUp),t.customTime)this.trigger("timechanged");else if(t.editItem){var n=this.items[t.itemIndex];if(t.moved||t.addItem){if(this.applyChange=!0,this.applyAdd=!0,this.updateData(t.itemIndex,{start:n.start,end:n.end}),this.trigger(t.addItem?"add":"changed"),n=this.items[t.itemIndex],t.addItem)this.applyAdd?this.updateData(t.itemIndex,{start:n.start,end:n.end,content:n.content,group:this.getGroupName(n.group)}):this.deleteItem(t.itemIndex);else if(this.applyChange)this.updateData(t.itemIndex,{start:n.start,end:n.end});else{delete this.applyChange,delete this.applyAdd;{var n=this.items[t.itemIndex];n.dom}n.start=t.itemStart,n.end=t.itemEnd,n.group=t.itemGroup,n.setPosition(t.itemLeft,t.itemRight),this.updateData(t.itemIndex,{start:t.itemStart,end:t.itemEnd})}this.options.cluster&&this.clusterGenerator.updateData(),this.render()}}else t.moved||t.zoomed?(this.render(),(t.moved&&i.moveable||t.zoomed&&i.zoomable)&&this.trigger("rangechanged")):t.target===this.dom.items.deleteButton?this.selection&&void 0!==this.selection.index&&this.confirmDeleteItem(this.selection.index):i.selectable&&(void 0!=t.itemIndex?this.isSelected(t.itemIndex)||(this.selectItem(t.itemIndex),this.trigger("select")):void 0!=t.clusterIndex?(this.selectCluster(t.clusterIndex),this.trigger("select")):i.unselectable&&(this.unselectItem(),this.trigger("select")))},links.Timeline.prototype.onDblClick=function(e){{var t=this.eventParams,i=this.options,n=this.dom;this.size}if(e=e||window.event,void 0!=t.itemIndex){var s=this.items[t.itemIndex];s&&this.isEditable(s)&&this.trigger("edit")}else if(i.editable){t.mouseX=links.Timeline.getPageX(e),t.mouseY=links.Timeline.getPageY(e);var o=t.mouseX-links.Timeline.getAbsoluteLeft(n.content),a=t.mouseY-links.Timeline.getAbsoluteTop(n.content),r=this.screenToTime(o);i.snapEvents&&this.step.snap(r);var l=i.NEW,h=this.getGroupFromHeight(a),m=!0;this.addItem({start:r,content:l,group:this.getGroupName(h)},m),t.itemIndex=this.items.length-1,this.selectItem(t.itemIndex),this.applyAdd=!0,this.trigger("add"),this.applyAdd?(this.render({animate:!1}),this.selectItem(t.itemIndex)):this.deleteItem(t.itemIndex)}links.Timeline.preventDefault(e)},links.Timeline.prototype.onMouseWheel=function(e){if(this.options.zoomable){e||(e=window.event);var t=0;if(e.wheelDelta?t=e.wheelDelta/120:e.detail&&(t=-e.detail/3),t){var i=this,n=function(){var n=t/5,s=links.Timeline.getAbsoluteLeft(i.dom.content),o=links.Timeline.getPageX(e),a=void 0!=o&&void 0!=s?i.screenToTime(o-s):void 0;i.zoom(n,a),i.trigger("rangechange"),i.trigger("rangechanged")},s=function(){i.move(t*-.2),i.trigger("rangechange"),i.trigger("rangechanged")};e.shiftKey?s():n()}links.Timeline.preventDefault(e)}},links.Timeline.prototype.zoom=function(e,t){void 0==t&&(t=new Date((this.start.valueOf()+this.end.valueOf())/2)),e>=1&&(e=.9),-1>=e&&(e=-.9),0>e&&(e/=1+e);var i=this.start.valueOf()-t,n=this.end.valueOf()-t,s=new Date(this.start.valueOf()-i*e),o=new Date(this.end.valueOf()-n*e),a=o.valueOf()-s.valueOf(),r=Number(this.options.zoomMin)||10;10>r&&(r=10),a>=r&&(this.applyRange(s,o,t),this.render({animate:this.options.animate&&this.options.animateZoom}))},links.Timeline.prototype.move=function(e){var t=this.end.valueOf()-this.start.valueOf(),i=new Date(this.start.valueOf()+t*e),n=new Date(this.end.valueOf()+t*e);this.applyRange(i,n),this.render()},links.Timeline.prototype.applyRange=function(e,t,i){var n=e.valueOf(),s=t.valueOf(),o=s-n,a=this.options,r=31536e6,l=Number(a.zoomMin)||10;10>l&&(l=10);var h=Number(a.zoomMax)||1e4*r;h>1e4*r&&(h=1e4*r),l>h&&(h=l);var m=a.min?a.min.valueOf():void 0,p=a.max?a.max.valueOf():void 0;if(void 0!=m&&void 0!=p){if(m>=p){var u=864e5;p=m+u}h>p-m&&(h=p-m),l>p-m&&(l=p-m)}if(n>=s&&(s+=864e5),l>o){var d=l-o,c=i?(i.valueOf()-n)/o:.5;n-=Math.round(d*c),s+=Math.round(d*(1-c))}if(o>h){var d=o-h,c=i?(i.valueOf()-n)/o:.5;n+=Math.round(d*c),s-=Math.round(d*(1-c))}if(void 0!=m){var d=n-m;0>d&&(n-=d,s-=d)}if(void 0!=p){var d=p-s;0>d&&(n+=d,s+=d)}this.start=new Date(n),this.end=new Date(s)},links.Timeline.prototype.confirmDeleteItem=function(e){this.applyDelete=!0,this.isSelected(e)||this.selectItem(e),this.trigger("delete"),this.applyDelete&&this.deleteItem(e),delete this.applyDelete},links.Timeline.prototype.deleteItem=function(e,t){if(e>=this.items.length)throw"Cannot delete row, index out of range";this.selection&&void 0!==this.selection.index&&(this.selection.index==e?this.unselectItem():this.selection.index>e&&this.selection.index--);var i=this.items.splice(e,1)[0];if(this.renderQueue.hide.push(i),this.data)if(google&&google.visualization&&this.data instanceof google.visualization.DataTable)this.data.removeRow(e);else{if(!links.Timeline.isArray(this.data))throw"Cannot delete row from data, unknown data type";this.data.splice(e,1)}this.options.cluster&&this.clusterGenerator.updateData(),t||this.render()},links.Timeline.prototype.deleteAllItems=function(){if(this.unselectItem(),this.clearItems(),this.deleteGroups(),this.data)if(google&&google.visualization&&this.data instanceof google.visualization.DataTable)this.data.removeRows(0,this.data.getNumberOfRows());else{if(!links.Timeline.isArray(this.data))throw"Cannot delete row from data, unknown data type";this.data.splice(0,this.data.length)}this.options.cluster&&this.clusterGenerator.updateData(),this.render()},links.Timeline.prototype.getGroupFromHeight=function(e){var t,i,n=this.groups;if(n.length){if(this.options.axisOnTop){for(t=n.length-1;t>=0;t--)if(i=n[t],e>i.top)return i}else for(t=0;t<n.length;t++)if(i=n[t],e>i.top)return i;return i}return void 0},links.Timeline.Item=function(e,t){if(e&&(this.start=e.start,this.end=e.end,this.content=e.content,this.className=e.className,this.editable=e.editable,this.group=e.group,this.type=e.type),this.top=0,this.left=0,this.width=0,this.height=0,this.lineWidth=0,this.dotWidth=0,this.dotHeight=0,this.rendered=!1,t)for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i])},links.Timeline.Item.prototype.reflow=function(){return!1},links.Timeline.Item.prototype.getImageUrls=function(e){this.dom&&links.imageloader.filterImageUrls(this.dom,e)},links.Timeline.Item.prototype.select=function(){},links.Timeline.Item.prototype.unselect=function(){},links.Timeline.Item.prototype.createDOM=function(){},links.Timeline.Item.prototype.showDOM=function(){},links.Timeline.Item.prototype.hideDOM=function(){},links.Timeline.Item.prototype.updateDOM=function(){},links.Timeline.Item.prototype.updatePosition=function(){},links.Timeline.Item.prototype.isRendered=function(){return this.rendered},links.Timeline.Item.prototype.isVisible=function(){return!1},links.Timeline.Item.prototype.setPosition=function(){},links.Timeline.Item.prototype.getLeft=function(){return 0},links.Timeline.Item.prototype.getRight=function(){return 0},links.Timeline.Item.prototype.getWidth=function(){return this.width||0},links.Timeline.ItemBox=function(e,t){links.Timeline.Item.call(this,e,t)},links.Timeline.ItemBox.prototype=new links.Timeline.Item,links.Timeline.ItemBox.prototype.reflow=function(){var e=this.dom,t=e.dot.offsetHeight,i=e.dot.offsetWidth,n=e.line.offsetWidth,s=this.dotHeight!=t||this.dotWidth!=i||this.lineWidth!=n;return this.dotHeight=t,this.dotWidth=i,this.lineWidth=n,s},links.Timeline.ItemBox.prototype.select=function(){var e=this.dom;links.Timeline.addClassName(e,"timeline-event-selected ui-state-active"),links.Timeline.addClassName(e.line,"timeline-event-selected ui-state-active"),links.Timeline.addClassName(e.dot,"timeline-event-selected ui-state-active")},links.Timeline.ItemBox.prototype.unselect=function(){var e=this.dom;links.Timeline.removeClassName(e,"timeline-event-selected ui-state-active"),links.Timeline.removeClassName(e.line,"timeline-event-selected ui-state-active"),links.Timeline.removeClassName(e.dot,"timeline-event-selected ui-state-active")},links.Timeline.ItemBox.prototype.createDOM=function(){var e=document.createElement("DIV");e.style.position="absolute",e.style.left=this.left+"px",e.style.top=this.top+"px";var t=document.createElement("DIV");t.className="timeline-event-content",t.innerHTML=this.content,e.appendChild(t);var i=document.createElement("DIV");i.style.position="absolute",i.style.width="0px",e.line=i;var n=document.createElement("DIV");return n.style.position="absolute",n.style.width="0px",n.style.height="0px",e.dot=n,this.dom=e,this.updateDOM(),e},links.Timeline.ItemBox.prototype.showDOM=function(e){var t=this.dom;t||(t=this.createDOM()),t.parentNode!=e&&(t.parentNode&&this.hideDOM(),e.appendChild(t),e.insertBefore(t.line,e.firstChild),e.appendChild(t.dot),this.rendered=!0)},links.Timeline.ItemBox.prototype.hideDOM=function(){var e=this.dom;e&&(e.parentNode&&e.parentNode.removeChild(e),e.line&&e.line.parentNode&&e.line.parentNode.removeChild(e.line),e.dot&&e.dot.parentNode&&e.dot.parentNode.removeChild(e.dot),this.rendered=!1)},links.Timeline.ItemBox.prototype.updateDOM=function(){var e=this.dom;if(e){var t=e.line,i=e.dot;e.firstChild.innerHTML=this.content,e.className="timeline-event timeline-event-box ui-widget ui-state-default",t.className="timeline-event timeline-event-line ui-widget ui-state-default",i.className="timeline-event timeline-event-dot ui-widget ui-state-default",this.isCluster&&(links.Timeline.addClassName(e,"timeline-event-cluster ui-widget-header"),links.Timeline.addClassName(t,"timeline-event-cluster ui-widget-header"),links.Timeline.addClassName(i,"timeline-event-cluster ui-widget-header")),this.className&&(links.Timeline.addClassName(e,this.className),links.Timeline.addClassName(t,this.className),links.Timeline.addClassName(i,this.className))}},links.Timeline.ItemBox.prototype.updatePosition=function(e){var t=this.dom;if(t){var i=e.timeToScreen(this.start),n=e.options.axisOnTop,s=e.size.axis.top,o=e.size.axis.height,a=e.options.box&&e.options.box.align?e.options.box.align:void 0;t.style.top=this.top+"px",t.style.left="right"==a?i-this.width+"px":"left"==a?i+"px":i-this.width/2+"px";var r=t.line,l=t.dot;r.style.left=i-this.lineWidth/2+"px",l.style.left=i-this.dotWidth/2+"px",n?(r.style.top=o+"px",r.style.height=Math.max(this.top-o,0)+"px",l.style.top=o-this.dotHeight/2+"px"):(r.style.top=this.top+this.height+"px",r.style.height=Math.max(s-this.top-this.height,0)+"px",l.style.top=s-this.dotHeight/2+"px")}},links.Timeline.ItemBox.prototype.isVisible=function(e,t){return this.cluster?!1:this.start>e&&this.start<t},links.Timeline.ItemBox.prototype.setPosition=function(e){var t=this.dom;t.style.left=e-this.width/2+"px",t.line.style.left=e-this.lineWidth/2+"px",t.dot.style.left=e-this.dotWidth/2+"px",this.group&&(this.top=this.group.top,t.style.top=this.top+"px")},links.Timeline.ItemBox.prototype.getLeft=function(e){var t=e.options.box&&e.options.box.align?e.options.box.align:void 0,i=e.timeToScreen(this.start);return i-="right"==t?width:this.width/2},links.Timeline.ItemBox.prototype.getRight=function(e){var t,i=e.options.box&&e.options.box.align?e.options.box.align:void 0,n=e.timeToScreen(this.start);return t="right"==i?n:"left"==i?n+this.width:n+this.width/2},links.Timeline.ItemRange=function(e,t){links.Timeline.Item.call(this,e,t)},links.Timeline.ItemRange.prototype=new links.Timeline.Item,links.Timeline.ItemRange.prototype.select=function(){var e=this.dom;links.Timeline.addClassName(e,"timeline-event-selected ui-state-active")},links.Timeline.ItemRange.prototype.unselect=function(){var e=this.dom;links.Timeline.removeClassName(e,"timeline-event-selected ui-state-active")},links.Timeline.ItemRange.prototype.createDOM=function(){var e=document.createElement("DIV");e.style.position="absolute";var t=document.createElement("DIV");return t.className="timeline-event-content",e.appendChild(t),this.dom=e,this.updateDOM(),e},links.Timeline.ItemRange.prototype.showDOM=function(e){var t=this.dom;t||(t=this.createDOM()),t.parentNode!=e&&(t.parentNode&&this.hideDOM(),e.appendChild(t),this.rendered=!0)},links.Timeline.ItemRange.prototype.hideDOM=function(){var e=this.dom;e&&(e.parentNode&&e.parentNode.removeChild(e),this.rendered=!1)},links.Timeline.ItemRange.prototype.updateDOM=function(){var e=this.dom;e&&(e.firstChild.innerHTML=this.content,e.className="timeline-event timeline-event-range ui-widget ui-state-default",this.isCluster&&links.Timeline.addClassName(e,"timeline-event-cluster ui-widget-header"),this.className&&links.Timeline.addClassName(e,this.className))},links.Timeline.ItemRange.prototype.updatePosition=function(e){var t=this.dom;if(t){var i=e.size.contentWidth,n=e.timeToScreen(this.start),s=e.timeToScreen(this.end);-i>n&&(n=-i),s>2*i&&(s=2*i),t.style.top=this.top+"px",t.style.left=n+"px",t.style.width=Math.max(s-n,1)+"px"}},links.Timeline.ItemRange.prototype.isVisible=function(e,t){return this.cluster?!1:this.end>e&&this.start<t},links.Timeline.ItemRange.prototype.setPosition=function(e,t){var i=this.dom;i.style.left=e+"px",i.style.width=t-e+"px",this.group&&(this.top=this.group.top,i.style.top=this.top+"px")},links.Timeline.ItemRange.prototype.getLeft=function(e){return e.timeToScreen(this.start)},links.Timeline.ItemRange.prototype.getRight=function(e){return e.timeToScreen(this.end)},links.Timeline.ItemRange.prototype.getWidth=function(e){return e.timeToScreen(this.end)-e.timeToScreen(this.start)},links.Timeline.ItemFloatingRange=function(e,t){links.Timeline.Item.call(this,e,t)},links.Timeline.ItemFloatingRange.prototype=new links.Timeline.Item,links.Timeline.ItemFloatingRange.prototype.select=function(){var e=this.dom;links.Timeline.addClassName(e,"timeline-event-selected ui-state-active")},links.Timeline.ItemFloatingRange.prototype.unselect=function(){var e=this.dom;links.Timeline.removeClassName(e,"timeline-event-selected ui-state-active")},links.Timeline.ItemFloatingRange.prototype.createDOM=function(){var e=document.createElement("DIV");e.style.position="absolute";var t=document.createElement("DIV");return t.className="timeline-event-content",e.appendChild(t),this.dom=e,this.updateDOM(),e},links.Timeline.ItemFloatingRange.prototype.showDOM=function(e){var t=this.dom;t||(t=this.createDOM()),t.parentNode!=e&&(t.parentNode&&this.hideDOM(),e.appendChild(t),this.rendered=!0)},links.Timeline.ItemFloatingRange.prototype.hideDOM=function(){var e=this.dom;e&&(e.parentNode&&e.parentNode.removeChild(e),this.rendered=!1)},links.Timeline.ItemFloatingRange.prototype.updateDOM=function(){var e=this.dom;e&&(e.firstChild.innerHTML=this.content,e.className="timeline-event timeline-event-range ui-widget ui-state-default",this.isCluster&&links.Timeline.addClassName(e,"timeline-event-cluster ui-widget-header"),this.className&&links.Timeline.addClassName(e,this.className))},links.Timeline.ItemFloatingRange.prototype.updatePosition=function(e){var t=this.dom;if(t){var i=e.size.contentWidth,n=this.getLeft(e),s=this.getRight(e);-i>n&&(n=-i),s>2*i&&(s=2*i),t.style.top=this.top+"px",t.style.left=n+"px",t.style.width=Math.max(s-n,1)+"px"}},links.Timeline.ItemFloatingRange.prototype.isVisible=function(e,t){return this.cluster?!1:this.end&&this.start?this.end>e&&this.start<t:this.start?this.start<t:this.end?this.end>e:!0},links.Timeline.ItemFloatingRange.prototype.setPosition=function(e,t){var i=this.dom;i.style.left=e+"px",i.style.width=t-e+"px",this.group&&(this.top=this.group.top,i.style.top=this.top+"px")},links.Timeline.ItemFloatingRange.prototype.getLeft=function(e){return this.start?e.timeToScreen(this.start):0},links.Timeline.ItemFloatingRange.prototype.getRight=function(e){return this.end?e.timeToScreen(this.end):e.size.contentWidth},links.Timeline.ItemFloatingRange.prototype.getWidth=function(e){return this.getRight(e)-this.getLeft(e)},links.Timeline.ItemDot=function(e,t){links.Timeline.Item.call(this,e,t)},links.Timeline.ItemDot.prototype=new links.Timeline.Item,links.Timeline.ItemDot.prototype.reflow=function(){var e=this.dom,t=e.dot.offsetHeight,i=e.dot.offsetWidth,n=e.content.offsetHeight,s=this.dotHeight!=t||this.dotWidth!=i||this.contentHeight!=n;return this.dotHeight=t,this.dotWidth=i,this.contentHeight=n,s},links.Timeline.ItemDot.prototype.select=function(){var e=this.dom;links.Timeline.addClassName(e,"timeline-event-selected ui-state-active")},links.Timeline.ItemDot.prototype.unselect=function(){var e=this.dom;links.Timeline.removeClassName(e,"timeline-event-selected ui-state-active")},links.Timeline.ItemDot.prototype.createDOM=function(){var e=document.createElement("DIV");e.style.position="absolute";var t=document.createElement("DIV");t.className="timeline-event-content",e.appendChild(t);var i=document.createElement("DIV");return i.style.position="absolute",i.style.width="0px",i.style.height="0px",e.appendChild(i),e.content=t,e.dot=i,this.dom=e,this.updateDOM(),e},links.Timeline.ItemDot.prototype.showDOM=function(e){var t=this.dom;t||(t=this.createDOM()),t.parentNode!=e&&(t.parentNode&&this.hideDOM(),e.appendChild(t),this.rendered=!0)},links.Timeline.ItemDot.prototype.hideDOM=function(){var e=this.dom;e&&(e.parentNode&&e.parentNode.removeChild(e),this.rendered=!1)},links.Timeline.ItemDot.prototype.updateDOM=function(){if(this.dom){var e=this.dom,t=e.dot;e.firstChild.innerHTML=this.content,e.className="timeline-event-dot-container",t.className="timeline-event timeline-event-dot ui-widget ui-state-default",this.isCluster&&(links.Timeline.addClassName(e,"timeline-event-cluster ui-widget-header"),links.Timeline.addClassName(t,"timeline-event-cluster ui-widget-header")),this.className&&(links.Timeline.addClassName(e,this.className),links.Timeline.addClassName(t,this.className))}},links.Timeline.ItemDot.prototype.updatePosition=function(e){var t=this.dom;if(t){var i=e.timeToScreen(this.start);t.style.top=this.top+"px",t.style.left=i-this.dotWidth/2+"px",t.content.style.marginLeft=1.5*this.dotWidth+"px",t.dot.style.top=(this.height-this.dotHeight)/2+"px"}},links.Timeline.ItemDot.prototype.isVisible=function(e,t){return this.cluster?!1:this.start>e&&this.start<t},links.Timeline.ItemDot.prototype.setPosition=function(e){var t=this.dom;t.style.left=e-this.dotWidth/2+"px",this.group&&(this.top=this.group.top,t.style.top=this.top+"px")},links.Timeline.ItemDot.prototype.getLeft=function(e){return e.timeToScreen(this.start)},links.Timeline.ItemDot.prototype.getRight=function(e){return e.timeToScreen(this.start)+this.width},links.Timeline.prototype.getItem=function(e){if(e>=this.items.length)throw"Cannot get item, index out of range";var t,i=this.data;if(google&&google.visualization&&i instanceof google.visualization.DataTable){var n=links.Timeline.mapColumnIds(i);t={};for(var s in n)n.hasOwnProperty(s)&&(t[s]=this.data.getValue(e,n[s]))}else{if(!links.Timeline.isArray(this.data))throw"Unknown data type. DataTable or Array expected.";t=links.Timeline.clone(this.data[e])}var o=this.items[e];return t.start=new Date(o.start.valueOf()),o.end&&(t.end=new Date(o.end.valueOf())),t.content=o.content,o.group&&(t.group=this.getGroupName(o.group)),o.className&&(t.className=o.className),"undefined"!=typeof o.editable&&(t.editable=o.editable),o.type&&(t.type=o.type),t},links.Timeline.prototype.getCluster=function(e){if(e>=this.clusters.length)throw"Cannot get cluster, index out of range";var t={},i=this.clusters[e],n=i.items;t.start=new Date(i.start.valueOf()),i.type&&(t.type=i.type),t.items=[];for(var s=0;s<n.length;s++)for(var o=0;o<this.items.length;o++)if(this.items[o]==n[s]){t.items.push(this.getItem(o));break}return t},links.Timeline.prototype.addItem=function(e,t){var i=[e];this.addItems(i,t)},links.Timeline.prototype.addItems=function(e,t){var i=this,n=this.items;e.forEach(function(e){var t=n.length;n.push(i.createItem(e)),i.updateData(t,e)}),this.options.cluster&&this.clusterGenerator.updateData(),t||this.render({animate:!1})},links.Timeline.prototype.createItem=function(e){var t=e.type||(e.end?"range":this.options.style),i=links.Timeline.clone(e);i.type=t,i.group=this.getGroup(e.group);var n,s=this.options;return n=s.axisOnTop?this.size.axis.height+s.eventMarginAxis+s.eventMargin/2:this.size.contentHeight-s.eventMarginAxis-s.eventMargin/2,t in this.itemTypes?new this.itemTypes[t](i,{top:n}):(console.log('ERROR: Unknown event type "'+t+'"'),new links.Timeline.Item(i,{top:n}))},links.Timeline.prototype.changeItem=function(e,t,i){var n=this.items[e];if(!n)throw"Cannot change item, index out of range";var s=this.createItem({start:t.hasOwnProperty("start")?t.start:n.start,end:t.hasOwnProperty("end")?t.end:n.end,content:t.hasOwnProperty("content")?t.content:n.content,group:t.hasOwnProperty("group")?t.group:this.getGroupName(n.group),className:t.hasOwnProperty("className")?t.className:n.className,editable:t.hasOwnProperty("editable")?t.editable:n.editable,type:t.hasOwnProperty("type")?t.type:n.type});this.items[e]=s,this.renderQueue.hide.push(n),this.renderQueue.show.push(s),this.updateData(e,t),this.options.cluster&&this.clusterGenerator.updateData(),i||(this.render({animate:!1}),this.selection&&this.selection.index==e&&s.select())},links.Timeline.prototype.deleteGroups=function(){this.groups=[],this.groupIndexes={}},links.Timeline.prototype.getGroup=function(e){var t=this.groups,i=this.groupIndexes,n=void 0,s=i[e];if(void 0==s&&void 0!=e){n={content:e,labelTop:0,lineTop:0},t.push(n),1==this.options.groupsOrder?t=t.sort(function(e,t){return e.content>t.content?1:e.content<t.content?-1:0}):"function"==typeof this.options.groupsOrder&&(t=t.sort(this.options.groupsOrder));for(var o=0,a=t.length;a>o;o++)i[t[o].content]=o}else n=t[s];return n},links.Timeline.prototype.getGroupName=function(e){return e?e.content:void 0},links.Timeline.prototype.cancelChange=function(){this.applyChange=!1},links.Timeline.prototype.cancelDelete=function(){this.applyDelete=!1},links.Timeline.prototype.cancelAdd=function(){this.applyAdd=!1},links.Timeline.prototype.setSelection=function(e){if(void 0!=e&&e.length>0){if(void 0!=e[0].row){var t=e[0].row;if(this.items[t]){var i=this.items[t];this.selectItem(t);var n,s=i.start,o=i.end;n=void 0!=o?(o.valueOf()+s.valueOf())/2:s.valueOf();var a=this.end.valueOf()-this.start.valueOf(),r=new Date(n-a/2),l=new Date(n+a/2);return this.setVisibleChartRange(r,l),!0}}}else this.unselectItem();return!1},links.Timeline.prototype.getSelection=function(){var e=[];return this.selection&&e.push(void 0!==this.selection.index?{row:this.selection.index}:{cluster:this.selection.cluster}),e},links.Timeline.prototype.selectItem=function(e){if(this.unselectItem(),this.selection=void 0,void 0!=this.items[e]){{var t=this.items[e];t.dom}this.selection={index:e},t&&t.dom&&(this.isEditable(t)&&(t.dom.style.cursor="move"),t.select()),this.repaintDeleteButton(),this.repaintDragAreas()}},links.Timeline.prototype.selectCluster=function(e){this.unselectItem(),this.selection=void 0,void 0!=this.clusters[e]&&(this.selection={cluster:e},this.repaintDeleteButton(),this.repaintDragAreas())},links.Timeline.prototype.isSelected=function(e){return this.selection&&this.selection.index==e},links.Timeline.prototype.unselectItem=function(){if(this.selection&&void 0!==this.selection.index){var e=this.items[this.selection.index];if(e&&e.dom){var t=e.dom;t.style.cursor="",e.unselect()}this.selection=void 0,this.repaintDeleteButton(),this.repaintDragAreas()}},links.Timeline.prototype.stackItems=function(e){void 0==e&&(e=!1);var t=this.stack;if(t||(t={},this.stack=t),t.sortedItems=this.stackOrder(this.renderedItems),t.finalItems=this.stackCalculateFinal(t.sortedItems),e||t.timer){var i=this,n=function(){var e=i.stackMoveOneStep(t.sortedItems,t.finalItems);i.repaint(),e?delete t.timer:t.timer=setTimeout(n,30)};t.timer||(t.timer=setTimeout(n,30))}else this.stackMoveToFinal(t.sortedItems,t.finalItems)},links.Timeline.prototype.stackCancelAnimation=function(){this.stack&&this.stack.timer&&(clearTimeout(this.stack.timer),delete this.stack.timer)},links.Timeline.prototype.getItemsByGroup=function(e){for(var t={},i=0;i<e.length;++i){var n=e[i],s="undefined";n.group&&(s=n.group.content?n.group.content:n.group),t[s]||(t[s]=[]),t[s].push(n)}return t},links.Timeline.prototype.stackOrder=function(e){var t=e.concat([]),i=this.options.customStackOrder&&"function"==typeof this.options.customStackOrder?this.options.customStackOrder:function(e,t){return(e instanceof links.Timeline.ItemRange||e instanceof links.Timeline.ItemFloatingRange)&&!(t instanceof links.Timeline.ItemRange||t instanceof links.Timeline.ItemFloatingRange)?-1:e instanceof links.Timeline.ItemRange||e instanceof links.Timeline.ItemFloatingRange||!(t instanceof links.Timeline.ItemRange||t instanceof links.Timeline.ItemFloatingRange)?e.left-t.left:1};return t.sort(i),t},links.Timeline.prototype.stackCalculateFinal=function(e){var t,i,n=this.size,s=this.options,o=s.axisOnTop,a=s.eventMargin,r=s.eventMarginAxis,l=o?n.axis.height+r+a/2:n.contentHeight-r-a/2,h=[];for(t=this.getItemsByGroup(e),j=0;j<this.groups.length;++j){var m=this.groups[j];t[m.content]?(i=this.finalItemsPosition(t[m.content],l,m),i.forEach(function(e){h.push(e)}),o?l+=m.itemsHeight+a:l-=m.itemsHeight+a):o?l+=s.groupMinHeight+a:l-=s.groupMinHeight+a}return t.undefined&&(i=this.finalItemsPosition(t.undefined,l),i.forEach(function(e){h.push(e)})),h},links.Timeline.prototype.finalItemsPosition=function(e,t,i){var n,s,o,a=this.options,r=a.axisOnTop,l=a.eventMargin;for(o=this.initialItemsPosition(e,t),n=0,s=o.length;s>n;n++){var h=o[n],m=null;if(this.options.stackEvents)do m=this.stackItemsCheckOverlap(o,n,0,n-1),null!=m&&(h.top=r?m.top+m.height+l:m.top-h.height-l,h.bottom=h.top+h.height);while(m);i&&(i.itemsHeight=r?i.itemsHeight?Math.max(i.itemsHeight,h.bottom-t):h.height+l:i.itemsHeight?Math.max(i.itemsHeight,t-h.top):h.height+l)}return o},links.Timeline.prototype.initialItemsPosition=function(e,t){for(var i=this.options,n=i.axisOnTop,s=[],o=0,a=e.length;a>o;++o){var r,l,h=e[o],m=h.height,p=h.getWidth(this),u=h.getRight(this),d=u-p;r=n?t:t-m,l=r+m,s.push({left:d,top:r,right:u,bottom:l,height:m,item:h})}return s},links.Timeline.prototype.stackMoveOneStep=function(e,t){for(var i=!0,n=0,s=t.length;s>n;n++){var o=t[n],a=o.item,r=parseInt(a.top),l=parseInt(o.top),h=l-r;if(h){var m=l==r?0:l>r?1:-1;Math.abs(h)>4&&(m=h/4);var p=parseInt(r+m);p!=l&&(i=!1),a.top=p,a.bottom=a.top+a.height}else a.top=o.top,a.bottom=o.bottom;a.left=o.left,a.right=o.right}return i},links.Timeline.prototype.stackMoveToFinal=function(e,t){for(var i=0,n=t.length;n>i;i++){var s=t[i],o=s.item;o.left=s.left,o.top=s.top,o.right=s.right,o.bottom=s.bottom}},links.Timeline.prototype.stackItemsCheckOverlap=function(e,t,i,n){for(var s=this.options.eventMargin,o=this.collision,a=e[t],r=n;r>=i;r--){var l=e[r];if(o(a,l,s)&&r!=t)return l}return void 0},links.Timeline.prototype.collision=function(e,t,i){return void 0==i&&(i=0),e.left-i<t.right&&e.right+i>t.left&&e.top-i<t.bottom&&e.bottom+i>t.top},links.Timeline.prototype.trigger=function(e){var t=null;switch(e){case"rangechange":case"rangechanged":t={start:new Date(this.start.valueOf()),end:new Date(this.end.valueOf())};break;case"timechange":case"timechanged":t={time:new Date(this.customTime.valueOf())}}links.events.trigger(this,e,t),google&&google.visualization&&google.visualization.events.trigger(this,e,t)},links.Timeline.prototype.clusterItems=function(){if(this.options.cluster){var e=this.clusterGenerator.getClusters(this.conversion.factor,this.options.clusterMaxItems);if(this.clusters!=e){var t=this.renderQueue;this.clusters&&this.clusters.forEach(function(e){t.hide.push(e),e.items.forEach(function(e){e.cluster=void 0})}),e.forEach(function(e){e.items.forEach(function(t){t.cluster=e})}),this.clusters=e}}},links.Timeline.prototype.filterItems=function(){function e(e){e.forEach(function(e){var i=e.rendered,o=e.isVisible(n,s);i!=o&&(i&&t.hide.push(e),o&&-1==t.show.indexOf(e)&&t.show.push(e))})}var t=this.renderQueue,i=this.end-this.start,n=new Date(this.start.valueOf()-i),s=new Date(this.end.valueOf()+i);e(this.items),this.clusters&&e(this.clusters)},links.Timeline.ClusterGenerator=function(e){this.timeline=e,this.clear()},links.Timeline.ClusterGenerator.prototype.clear=function(){this.items=[],this.groups={},this.clearCache()},links.Timeline.ClusterGenerator.prototype.clearCache=function(){this.cache={},this.cacheLevel=-1,this.cache[this.cacheLevel]=[]},links.Timeline.ClusterGenerator.prototype.setData=function(e,t){this.items=e||[],this.dataChanged=!0,this.applyOnChangedLevel=!0,t&&t.applyOnChangedLevel&&(this.applyOnChangedLevel=t.applyOnChangedLevel)},links.Timeline.ClusterGenerator.prototype.updateData=function(){this.dataChanged=!0,this.applyOnChangedLevel=!1},links.Timeline.ClusterGenerator.prototype.filterData=function(){var e=this.items||[],t={};this.groups=t,e.forEach(function(e){var i=e.group?e.group.content:"",n=t[i];n||(n=[],t[i]=n),n.push(e),e.start&&(e.center=e.end?(e.start.valueOf()+e.end.valueOf())/2:e.start.valueOf())});for(var i in t)t.hasOwnProperty(i)&&t[i].sort(function(e,t){return e.center-t.center});this.dataChanged=!1},links.Timeline.ClusterGenerator.prototype.getClusters=function(e,t){var i=-1,n=2,s=0;if(e>0&&(i=Math.round(Math.log(100/e)/Math.log(n)),s=Math.pow(n,i)),this.dataChanged){var o=i!=this.cacheLevel,a=this.applyOnChangedLevel?o:!0;a&&(this.clearCache(),this.filterData())}this.cacheLevel=i;var r=this.cache[i];if(!r){r=[];for(var l in this.groups)if(this.groups.hasOwnProperty(l))for(var h=this.groups[l],m=h.length,p=0;m>p;){for(var u=h[p],d=1,c=p-1;c>=0&&u.center-h[c].center<s/2;)h[c].cluster||d++,c--;for(var g=p+1;g<h.length&&h[g].center-u.center<s/2;)d++,g++;for(var f=r.length-1;f>=0&&u.center-r[f].center<s/2;)u.group==r[f].group&&d++,f--;if(d>t){for(var v=d-t+1,T=[],k=void 0,y=void 0,D=void 0,x=!1,M=0,S=p;T.length<v&&S<h.length;){var C=h[S],I=C.start.valueOf(),E=C.end?C.end.valueOf():C.start.valueOf();T.push(C),k=M?M/(M+1)*k+1/(M+1)*C.center:C.center,y=void 0!=y?Math.min(y,I):I,D=void 0!=D?Math.max(D,E):E,x=x||C instanceof links.Timeline.ItemRange||C instanceof links.Timeline.ItemFloatingRange,M++,S++}var O,w="Cluster containing "+M+" events. Zoom in to see the individual events.",L='<div title="'+w+'">'+M+" events</div>",b=u.group?u.group.content:void 0;O=this.timeline.createItem(x?{start:new Date(y),end:new Date(D),content:L,group:b}:{start:new Date(k),content:L,group:b}),O.isCluster=!0,O.items=T,O.items.forEach(function(e){e.cluster=O}),r.push(O),p+=v}else delete u.cluster,p+=1}this.cache[i]=r}return r},links.events=links.events||{listeners:[],indexOf:function(e){for(var t=this.listeners,i=0,n=this.listeners.length;n>i;i++){var s=t[i];if(s&&s.object==e)return i}return-1},addListener:function(e,t,i){var n=this.indexOf(e),s=this.listeners[n];s||(s={object:e,events:{}},this.listeners.push(s));var o=s.events[t];o||(o=[],s.events[t]=o),-1==o.indexOf(i)&&o.push(i)},removeListener:function(e,t,i){var n=this.indexOf(e),s=this.listeners[n];if(s){var o=s.events[t];if(o){var n=o.indexOf(i);-1!=n&&o.splice(n,1),0==o.length&&delete s.events[t]}var a=0,r=s.events;for(var l in r)r.hasOwnProperty(l)&&a++;0==a&&delete this.listeners[n]}},removeAllListeners:function(){this.listeners=[]},trigger:function(e,t,i){var n=this.indexOf(e),s=this.listeners[n];if(s){var o=s.events[t];if(o)for(var a=0,r=o.length;r>a;a++)o[a](i)}}},links.Timeline.StepDate=function(e,t,i){this.current=new Date,this._start=new Date,this._end=new Date,this.autoScale=!0,this.scale=links.Timeline.StepDate.SCALE.DAY,this.step=1,this.setRange(e,t,i)},links.Timeline.StepDate.SCALE={MILLISECOND:1,SECOND:2,MINUTE:3,HOUR:4,DAY:5,WEEKDAY:6,MONTH:7,YEAR:8},links.Timeline.StepDate.prototype.setRange=function(e,t,i){e instanceof Date&&t instanceof Date&&(this._start=void 0!=e?new Date(e.valueOf()):new Date,this._end=void 0!=t?new Date(t.valueOf()):new Date,this.autoScale&&this.setMinimumStep(i))},links.Timeline.StepDate.prototype.start=function(){this.current=new Date(this._start.valueOf()),this.roundToMinor()},links.Timeline.StepDate.prototype.roundToMinor=function(){switch(this.scale){case links.Timeline.StepDate.SCALE.YEAR:this.current.setFullYear(this.step*Math.floor(this.current.getFullYear()/this.step)),this.current.setMonth(0);case links.Timeline.StepDate.SCALE.MONTH:this.current.setDate(1);case links.Timeline.StepDate.SCALE.DAY:case links.Timeline.StepDate.SCALE.WEEKDAY:this.current.setHours(0);case links.Timeline.StepDate.SCALE.HOUR:this.current.setMinutes(0);case links.Timeline.StepDate.SCALE.MINUTE:this.current.setSeconds(0);case links.Timeline.StepDate.SCALE.SECOND:this.current.setMilliseconds(0)}if(1!=this.step)switch(this.scale){case links.Timeline.StepDate.SCALE.MILLISECOND:this.current.setMilliseconds(this.current.getMilliseconds()-this.current.getMilliseconds()%this.step);break;case links.Timeline.StepDate.SCALE.SECOND:this.current.setSeconds(this.current.getSeconds()-this.current.getSeconds()%this.step);break;case links.Timeline.StepDate.SCALE.MINUTE:this.current.setMinutes(this.current.getMinutes()-this.current.getMinutes()%this.step);break;case links.Timeline.StepDate.SCALE.HOUR:this.current.setHours(this.current.getHours()-this.current.getHours()%this.step);break;case links.Timeline.StepDate.SCALE.WEEKDAY:case links.Timeline.StepDate.SCALE.DAY:this.current.setDate(this.current.getDate()-1-(this.current.getDate()-1)%this.step+1);break;case links.Timeline.StepDate.SCALE.MONTH:this.current.setMonth(this.current.getMonth()-this.current.getMonth()%this.step);break;case links.Timeline.StepDate.SCALE.YEAR:this.current.setFullYear(this.current.getFullYear()-this.current.getFullYear()%this.step)}},links.Timeline.StepDate.prototype.end=function(){return this.current.valueOf()>this._end.valueOf()},links.Timeline.StepDate.prototype.next=function(){var e=this.current.valueOf();if(this.current.getMonth()<6)switch(this.scale){case links.Timeline.StepDate.SCALE.MILLISECOND:this.current=new Date(this.current.valueOf()+this.step);break;case links.Timeline.StepDate.SCALE.SECOND:this.current=new Date(this.current.valueOf()+1e3*this.step);break;case links.Timeline.StepDate.SCALE.MINUTE:this.current=new Date(this.current.valueOf()+1e3*this.step*60);break;case links.Timeline.StepDate.SCALE.HOUR:this.current=new Date(this.current.valueOf()+1e3*this.step*60*60);var t=this.current.getHours();this.current.setHours(t-t%this.step);break;case links.Timeline.StepDate.SCALE.WEEKDAY:case links.Timeline.StepDate.SCALE.DAY:this.current.setDate(this.current.getDate()+this.step);break;case links.Timeline.StepDate.SCALE.MONTH:this.current.setMonth(this.current.getMonth()+this.step);break;case links.Timeline.StepDate.SCALE.YEAR:this.current.setFullYear(this.current.getFullYear()+this.step)}else switch(this.scale){case links.Timeline.StepDate.SCALE.MILLISECOND:this.current=new Date(this.current.valueOf()+this.step);break;case links.Timeline.StepDate.SCALE.SECOND:this.current.setSeconds(this.current.getSeconds()+this.step);break;case links.Timeline.StepDate.SCALE.MINUTE:this.current.setMinutes(this.current.getMinutes()+this.step);break;case links.Timeline.StepDate.SCALE.HOUR:this.current.setHours(this.current.getHours()+this.step);break;case links.Timeline.StepDate.SCALE.WEEKDAY:case links.Timeline.StepDate.SCALE.DAY:this.current.setDate(this.current.getDate()+this.step);break;case links.Timeline.StepDate.SCALE.MONTH:this.current.setMonth(this.current.getMonth()+this.step);break;case links.Timeline.StepDate.SCALE.YEAR:this.current.setFullYear(this.current.getFullYear()+this.step)}if(1!=this.step)switch(this.scale){case links.Timeline.StepDate.SCALE.MILLISECOND:this.current.getMilliseconds()<this.step&&this.current.setMilliseconds(0);break;case links.Timeline.StepDate.SCALE.SECOND:this.current.getSeconds()<this.step&&this.current.setSeconds(0);break;case links.Timeline.StepDate.SCALE.MINUTE:this.current.getMinutes()<this.step&&this.current.setMinutes(0);break;case links.Timeline.StepDate.SCALE.HOUR:this.current.getHours()<this.step&&this.current.setHours(0);break;case links.Timeline.StepDate.SCALE.WEEKDAY:case links.Timeline.StepDate.SCALE.DAY:this.current.getDate()<this.step+1&&this.current.setDate(1);break;case links.Timeline.StepDate.SCALE.MONTH:this.current.getMonth()<this.step&&this.current.setMonth(0);break;case links.Timeline.StepDate.SCALE.YEAR:}this.current.valueOf()==e&&(this.current=new Date(this._end.valueOf()))},links.Timeline.StepDate.prototype.getCurrent=function(){return this.current},links.Timeline.StepDate.prototype.setScale=function(e,t){this.scale=e,t>0&&(this.step=t),this.autoScale=!1},links.Timeline.StepDate.prototype.setAutoScale=function(e){this.autoScale=e},links.Timeline.StepDate.prototype.setMinimumStep=function(e){if(void 0!=e){var t=31104e6,i=2592e6,n=864e5,s=36e5,o=6e4,a=1e3,r=1;1e3*t>e&&(this.scale=links.Timeline.StepDate.SCALE.YEAR,this.step=1e3),500*t>e&&(this.scale=links.Timeline.StepDate.SCALE.YEAR,this.step=500),100*t>e&&(this.scale=links.Timeline.StepDate.SCALE.YEAR,this.step=100),50*t>e&&(this.scale=links.Timeline.StepDate.SCALE.YEAR,this.step=50),10*t>e&&(this.scale=links.Timeline.StepDate.SCALE.YEAR,this.step=10),5*t>e&&(this.scale=links.Timeline.StepDate.SCALE.YEAR,this.step=5),t>e&&(this.scale=links.Timeline.StepDate.SCALE.YEAR,this.step=1),3*i>e&&(this.scale=links.Timeline.StepDate.SCALE.MONTH,this.step=3),i>e&&(this.scale=links.Timeline.StepDate.SCALE.MONTH,this.step=1),5*n>e&&(this.scale=links.Timeline.StepDate.SCALE.DAY,this.step=5),2*n>e&&(this.scale=links.Timeline.StepDate.SCALE.DAY,this.step=2),n>e&&(this.scale=links.Timeline.StepDate.SCALE.DAY,this.step=1),n/2>e&&(this.scale=links.Timeline.StepDate.SCALE.WEEKDAY,this.step=1),4*s>e&&(this.scale=links.Timeline.StepDate.SCALE.HOUR,this.step=4),s>e&&(this.scale=links.Timeline.StepDate.SCALE.HOUR,this.step=1),15*o>e&&(this.scale=links.Timeline.StepDate.SCALE.MINUTE,this.step=15),10*o>e&&(this.scale=links.Timeline.StepDate.SCALE.MINUTE,this.step=10),5*o>e&&(this.scale=links.Timeline.StepDate.SCALE.MINUTE,this.step=5),o>e&&(this.scale=links.Timeline.StepDate.SCALE.MINUTE,this.step=1),15*a>e&&(this.scale=links.Timeline.StepDate.SCALE.SECOND,this.step=15),10*a>e&&(this.scale=links.Timeline.StepDate.SCALE.SECOND,this.step=10),5*a>e&&(this.scale=links.Timeline.StepDate.SCALE.SECOND,this.step=5),a>e&&(this.scale=links.Timeline.StepDate.SCALE.SECOND,this.step=1),200*r>e&&(this.scale=links.Timeline.StepDate.SCALE.MILLISECOND,this.step=200),100*r>e&&(this.scale=links.Timeline.StepDate.SCALE.MILLISECOND,this.step=100),50*r>e&&(this.scale=links.Timeline.StepDate.SCALE.MILLISECOND,this.step=50),10*r>e&&(this.scale=links.Timeline.StepDate.SCALE.MILLISECOND,this.step=10),5*r>e&&(this.scale=links.Timeline.StepDate.SCALE.MILLISECOND,this.step=5),r>e&&(this.scale=links.Timeline.StepDate.SCALE.MILLISECOND,this.step=1)}},links.Timeline.StepDate.prototype.snap=function(e){if(this.scale==links.Timeline.StepDate.SCALE.YEAR){var t=e.getFullYear()+Math.round(e.getMonth()/12);e.setFullYear(Math.round(t/this.step)*this.step),e.setMonth(0),e.setDate(0),e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0)}else if(this.scale==links.Timeline.StepDate.SCALE.MONTH)e.getDate()>15?(e.setDate(1),e.setMonth(e.getMonth()+1)):e.setDate(1),e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0);else if(this.scale==links.Timeline.StepDate.SCALE.DAY||this.scale==links.Timeline.StepDate.SCALE.WEEKDAY){switch(this.step){case 5:case 2:e.setHours(24*Math.round(e.getHours()/24));break;default:e.setHours(12*Math.round(e.getHours()/12))}e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0)}else if(this.scale==links.Timeline.StepDate.SCALE.HOUR){switch(this.step){case 4:e.setMinutes(60*Math.round(e.getMinutes()/60));break;default:e.setMinutes(30*Math.round(e.getMinutes()/30))}e.setSeconds(0),e.setMilliseconds(0)}else if(this.scale==links.Timeline.StepDate.SCALE.MINUTE){switch(this.step){case 15:case 10:e.setMinutes(5*Math.round(e.getMinutes()/5)),e.setSeconds(0);break;case 5:e.setSeconds(60*Math.round(e.getSeconds()/60));break;default:e.setSeconds(30*Math.round(e.getSeconds()/30))}e.setMilliseconds(0)}else if(this.scale==links.Timeline.StepDate.SCALE.SECOND)switch(this.step){case 15:case 10:e.setSeconds(5*Math.round(e.getSeconds()/5)),e.setMilliseconds(0);break;case 5:e.setMilliseconds(1e3*Math.round(e.getMilliseconds()/1e3));break;default:e.setMilliseconds(500*Math.round(e.getMilliseconds()/500))}else if(this.scale==links.Timeline.StepDate.SCALE.MILLISECOND){var i=this.step>5?this.step/2:1;e.setMilliseconds(Math.round(e.getMilliseconds()/i)*i)}},links.Timeline.StepDate.prototype.isMajor=function(){switch(this.scale){case links.Timeline.StepDate.SCALE.MILLISECOND:return 0==this.current.getMilliseconds();case links.Timeline.StepDate.SCALE.SECOND:return 0==this.current.getSeconds();case links.Timeline.StepDate.SCALE.MINUTE:return 0==this.current.getHours()&&0==this.current.getMinutes();case links.Timeline.StepDate.SCALE.HOUR:return 0==this.current.getHours();case links.Timeline.StepDate.SCALE.WEEKDAY:case links.Timeline.StepDate.SCALE.DAY:return 1==this.current.getDate();case links.Timeline.StepDate.SCALE.MONTH:return 0==this.current.getMonth();case links.Timeline.StepDate.SCALE.YEAR:return!1;default:return!1}},links.Timeline.StepDate.prototype.getLabelMinor=function(e,t){switch(void 0==t&&(t=this.current),this.scale){case links.Timeline.StepDate.SCALE.MILLISECOND:return String(t.getMilliseconds());case links.Timeline.StepDate.SCALE.SECOND:return String(t.getSeconds());case links.Timeline.StepDate.SCALE.MINUTE:return this.addZeros(t.getHours(),2)+":"+this.addZeros(t.getMinutes(),2);case links.Timeline.StepDate.SCALE.HOUR:return this.addZeros(t.getHours(),2)+":"+this.addZeros(t.getMinutes(),2);case links.Timeline.StepDate.SCALE.WEEKDAY:return e.DAYS_SHORT[t.getDay()]+" "+t.getDate();case links.Timeline.StepDate.SCALE.DAY:return String(t.getDate());case links.Timeline.StepDate.SCALE.MONTH:return e.MONTHS_SHORT[t.getMonth()];case links.Timeline.StepDate.SCALE.YEAR:return String(t.getFullYear());default:return""}},links.Timeline.StepDate.prototype.getLabelMajor=function(e,t){switch(void 0==t&&(t=this.current),this.scale){case links.Timeline.StepDate.SCALE.MILLISECOND:return this.addZeros(t.getHours(),2)+":"+this.addZeros(t.getMinutes(),2)+":"+this.addZeros(t.getSeconds(),2);case links.Timeline.StepDate.SCALE.SECOND:return t.getDate()+" "+e.MONTHS[t.getMonth()]+" "+this.addZeros(t.getHours(),2)+":"+this.addZeros(t.getMinutes(),2);case links.Timeline.StepDate.SCALE.MINUTE:return e.DAYS[t.getDay()]+" "+t.getDate()+" "+e.MONTHS[t.getMonth()]+" "+t.getFullYear();case links.Timeline.StepDate.SCALE.HOUR:return e.DAYS[t.getDay()]+" "+t.getDate()+" "+e.MONTHS[t.getMonth()]+" "+t.getFullYear();case links.Timeline.StepDate.SCALE.WEEKDAY:case links.Timeline.StepDate.SCALE.DAY:return e.MONTHS[t.getMonth()]+" "+t.getFullYear();case links.Timeline.StepDate.SCALE.MONTH:return String(t.getFullYear());default:return""}},links.Timeline.StepDate.prototype.addZeros=function(e,t){for(var i=""+e;i.length<t;)i="0"+i;return i},links.imageloader=function(){function e(e){if(1==o[e])return!0;var t=new Image;return t.src=e,t.complete?!0:!1}function t(e){return void 0!=a[e]}function i(i,n,s){if(void 0==s&&(s=!0),e(i))return void(s&&n(i));if(!t(i)||s){var r=a[i];if(!r){var l=new Image;l.src=i,r=[],a[i]=r,l.onload=function(){o[i]=!0,delete a[i];for(var e=0;e<r.length;e++)r[e](i)}}-1==r.indexOf(n)&&r.push(n)}}function n(t,n,s){var o=[];if(t.forEach(function(t){e(t)||o.push(t)}),o.length){var a=o.length;o.forEach(function(e){i(e,function(){a--,0==a&&n()},s)})}else s&&n()}function s(e,t){for(var i=e.firstChild;i;){if("IMG"==i.tagName){var n=i.src;-1==t.indexOf(n)&&t.push(n)}s(i,t),i=i.nextSibling}}var o={},a={};return{isLoaded:e,isLoading:t,load:i,loadAll:n,filterImageUrls:s}}(),links.Timeline.addEventListener=function(e,t,i,n){e.addEventListener?(void 0===n&&(n=!1),"mousewheel"===t&&navigator.userAgent.indexOf("Firefox")>=0&&(t="DOMMouseScroll"),e.addEventListener(t,i,n)):e.attachEvent("on"+t,i)},links.Timeline.removeEventListener=function(e,t,i,n){e.removeEventListener?(void 0===n&&(n=!1),"mousewheel"===t&&navigator.userAgent.indexOf("Firefox")>=0&&(t="DOMMouseScroll"),e.removeEventListener(t,i,n)):e.detachEvent("on"+t,i)},links.Timeline.getTarget=function(e){e||(e=window.event);var t;return e.target?t=e.target:e.srcElement&&(t=e.srcElement),void 0!=t.nodeType&&3==t.nodeType&&(t=t.parentNode),t},links.Timeline.stopPropagation=function(e){e||(e=window.event),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},links.Timeline.preventDefault=function(e){e||(e=window.event),e.preventDefault?e.preventDefault():e.returnValue=!1},links.Timeline.getAbsoluteLeft=function(e){for(var t=document.documentElement,i=document.body,n=e.offsetLeft,s=e.offsetParent;null!=s&&s!=i&&s!=t;)n+=s.offsetLeft,n-=s.scrollLeft,s=s.offsetParent;return n},links.Timeline.getAbsoluteTop=function(e){for(var t=document.documentElement,i=document.body,n=e.offsetTop,s=e.offsetParent;null!=s&&s!=i&&s!=t;)n+=s.offsetTop,n-=s.scrollTop,s=s.offsetParent;return n},links.Timeline.getPageY=function(e){if("targetTouches"in e&&e.targetTouches.length&&(e=e.targetTouches[0]),"pageY"in e)return e.pageY;var t=e.clientY,i=document.documentElement,n=document.body;return t+(i&&i.scrollTop||n&&n.scrollTop||0)-(i&&i.clientTop||n&&n.clientTop||0)},links.Timeline.getPageX=function(e){if("targetTouches"in e&&e.targetTouches.length&&(e=e.targetTouches[0]),"pageX"in e)return e.pageX;var t=e.clientX,i=document.documentElement,n=document.body;return t+(i&&i.scrollLeft||n&&n.scrollLeft||0)-(i&&i.clientLeft||n&&n.clientLeft||0)},links.Timeline.addClassName=function(e,t){for(var i=e.className.split(" "),n=t.split(" "),s=!1,o=0;o<n.length;o++)-1==i.indexOf(n[o])&&(i.push(n[o]),s=!0);s&&(e.className=i.join(" "))},links.Timeline.removeClassName=function(e,t){for(var i=e.className.split(" "),n=t.split(" "),s=!1,o=0;o<n.length;o++){var a=i.indexOf(n[o]);-1!=a&&(i.splice(a,1),s=!0)}s&&(e.className=i.join(" "))},links.Timeline.isArray=function(e){return e instanceof Array?!0:"[object Array]"===Object.prototype.toString.call(e)},links.Timeline.clone=function(e){var t={};for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},links.Timeline.parseJSONDate=function(e){if(void 0==e)return void 0;if(e instanceof Date)return e;var t=e.match(/\/Date\((-?\d+)([-\+]?\d{2})?(\d{2})?\)\//i);if(t){var i=t[2]?36e5*t[2]+6e4*t[3]*(t[2]/Math.abs(t[2])):0;return new Date(1*t[1]+i)}return Date.parse(e)};

/* AjaxQ jQuery Plugin
   Copyright (c) 2012 Foliotek Inc.
   MIT License
   https://github.com/Foliotek/ajaxq */
!function(e){var n={},t={};e.ajaxq=function(r,a){function i(e){if(n[r])n[r].push(e);else{n[r]=[];var a=e();t[r]=a}}function u(){if(n[r]){var e=n[r].shift();if(e){var a=e();t[r]=a}else delete n[r],delete t[r]}}if("undefined"==typeof a)throw"AjaxQ: queue name is not provided";var o=e.Deferred(),f=o.promise();f.success=f.done,f.error=f.fail,f.complete=f.always;var s="function"==typeof a,c=s?null:e.extend(!0,{},a);return i(function(){var n=e.ajax.apply(window,[s?a():c]);return n.done(function(){o.resolve.apply(this,arguments)}),n.fail(function(){o.reject.apply(this,arguments)}),n.always(u),n}),f},e.each(["getq","postq"],function(n,t){e[t]=function(n,r,a,i,u){return e.isFunction(a)&&(u=u||i,i=a,a=void 0),e.ajaxq(n,{type:"postq"===t?"post":"get",url:r,data:a,success:i,dataType:u})}});var r=function(e){return n.hasOwnProperty(e)&&n[e].length>0},a=function(){for(var e in n)if(r(e))return!0;return!1};e.ajaxq.isRunning=function(e){return e?r(e):a()},e.ajaxq.getActiveRequest=function(e){if(!e)throw"AjaxQ: queue name is required";return t[e]},e.ajaxq.abort=function(r){if(!r)throw"AjaxQ: queue name is required";var a=e.ajaxq.getActiveRequest(r);delete n[r],delete t[r],a&&a.abort()},e.ajaxq.clear=function(e){if(e)n[e]&&(n[e]=[]);else for(var t in n)n.hasOwnProperty(t)&&(n[t]=[])}}(jQuery);

/*
 (c) 2011-2014, Vladimir Agafonkin
 SunCalc is a JavaScript library for calculating sun/moon position and light phases.
 https://github.com/mourner/suncalc
*/
!function(){"use strict";function n(n){return n.valueOf()/I-.5+S}function t(n){return new Date((n+.5-S)*I)}function e(t){return n(t)-T}function r(n,t){return b(P(n)*p(k)-D(t)*P(k),p(n))}function a(n,t){return y(P(t)*p(k)+p(t)*P(k)*P(n))}function u(n,t,e){return b(P(n),p(n)*P(t)-D(e)*p(t))}function i(n,t,e){return y(P(t)*P(e)+p(t)*p(e)*p(n))}function o(n,t){return H*(280.16+360.9856235*n)-t}function c(n){return H*(357.5291+.98560028*n)}function s(n){var t=H*(1.9148*P(n)+.02*P(2*n)+3e-4*P(3*n)),e=102.9372*H;return n+t+e+w}function d(n){var t=c(n),e=s(t);return{dec:a(e,0),ra:r(e,0)}}function f(n,t){return Math.round(n-q-t/(2*w))}function l(n,t,e){return q+(n+t)/(2*w)+e}function M(n,t,e){return T+n+.0053*P(t)-.0069*P(2*e)}function h(n,t,e){return E((P(n)-P(t)*P(e))/(p(t)*p(e)))}function v(n,t,e,r,a,u,i){var o=h(n,e,r),c=l(o,t,a);return M(c,u,i)}function g(n){var t=H*(218.316+13.176396*n),e=H*(134.963+13.064993*n),u=H*(93.272+13.22935*n),i=t+6.289*H*P(e),o=5.128*H*P(u),c=385001-20905*p(e);return{ra:r(i,o),dec:a(i,o),dist:c}}function m(n,t){return new Date(n.valueOf()+t*I/24)}var w=Math.PI,P=Math.sin,p=Math.cos,D=Math.tan,y=Math.asin,b=Math.atan2,E=Math.acos,H=w/180,I=864e5,S=2440588,T=2451545,k=23.4397*H,z={};z.getPosition=function(n,t,r){var a=H*-r,c=H*t,s=e(n),f=d(s),l=o(s,a)-f.ra;return{azimuth:u(l,c,f.dec),altitude:i(l,c,f.dec)}};var O=z.times=[[-.833,"sunrise","sunset"],[-.3,"sunriseEnd","sunsetStart"],[-6,"dawn","dusk"],[-12,"nauticalDawn","nauticalDusk"],[-18,"nightEnd","night"],[6,"goldenHourEnd","goldenHour"]];z.addTime=function(n,t,e){O.push([n,t,e])};var q=9e-4;z.getTimes=function(n,r,u){var i,o,d,h,g,m=H*-u,w=H*r,P=e(n),p=f(P,m),D=l(0,m,p),y=c(D),b=s(y),E=a(b,0),I=M(D,y,b),S={solarNoon:t(I),nadir:t(I-.5)};for(i=0,o=O.length;o>i;i+=1)d=O[i],h=v(d[0]*H,m,w,E,p,y,b),g=I-(h-I),S[d[1]]=t(g),S[d[2]]=t(h);return S},z.getMoonPosition=function(n,t,r){var a=H*-r,c=H*t,s=e(n),d=g(s),f=o(s,a)-d.ra,l=i(f,c,d.dec);return l+=.017*H/D(l+10.26*H/(l+5.1*H)),{azimuth:u(f,c,d.dec),altitude:l,distance:d.dist}},z.getMoonIllumination=function(n){var t=e(n),r=d(t),a=g(t),u=149598e3,i=E(P(r.dec)*P(a.dec)+p(r.dec)*p(a.dec)*p(r.ra-a.ra)),o=b(u*P(i),a.dist-u*p(i)),c=b(p(r.dec)*P(r.ra-a.ra),P(r.dec)*p(a.dec)-p(r.dec)*P(a.dec)*p(r.ra-a.ra));return{fraction:(1+p(o))/2,phase:.5+.5*o*(0>c?-1:1)/Math.PI,angle:c}},z.getMoonTimes=function(n,t,e){var r=new Date(n);r.setHours(0),r.setMinutes(0),r.setSeconds(0),r.setMilliseconds(0);for(var a,u,i,o,c,s,d,f,l,M,h,v,g,w=.133*H,P=z.getMoonPosition(r,t,e).altitude-w,p=1;24>=p&&(a=z.getMoonPosition(m(r,p),t,e).altitude-w,u=z.getMoonPosition(m(r,p+1),t,e).altitude-w,c=(P+u)/2-a,s=(u-P)/2,d=-s/(2*c),f=(c*d+s)*d+a,l=s*s-4*c*a,M=0,l>=0&&(g=Math.sqrt(l)/(2*Math.abs(c)),h=d-g,v=d+g,Math.abs(h)<=1&&M++,Math.abs(v)<=1&&M++,-1>h&&(h=v)),1===M?0>P?i=p+h:o=p+h:2===M&&(i=p+(0>f?v:h),o=p+(0>f?h:v)),!i||!o);p+=2)P=u;var D={};return i&&(D.rise=m(r,i)),o&&(D.set=m(r,o)),i||o||(D[f>0?"alwaysUp":"alwaysDown"]=!0),D},"function"==typeof define&&define.amd?define(z):"undefined"!=typeof module?module.exports=z:window.SunCalc=z}();

/*
 * JavaScript MD5 1.1.1
 * https://github.com/blueimp/JavaScript-MD5
 *
 * Copyright 2011, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 *
 * Based on
 * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message
 * Digest Algorithm, as defined in RFC 1321.
 * Version 2.2 Copyright (C) Paul Johnston 1999 - 2009
 * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet
 * Distributed under the BSD License
 * See http://pajhome.org.uk/crypt/md5 for more info.
 */
!function(a){"use strict";function b(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function c(a,b){return a<<b|a>>>32-b}function d(a,d,e,f,g,h){return b(c(b(b(d,a),b(f,h)),g),e)}function e(a,b,c,e,f,g,h){return d(b&c|~b&e,a,b,f,g,h)}function f(a,b,c,e,f,g,h){return d(b&e|c&~e,a,b,f,g,h)}function g(a,b,c,e,f,g,h){return d(b^c^e,a,b,f,g,h)}function h(a,b,c,e,f,g,h){return d(c^(b|~e),a,b,f,g,h)}function i(a,c){a[c>>5]|=128<<c%32,a[(c+64>>>9<<4)+14]=c;var d,i,j,k,l,m=1732584193,n=-271733879,o=-1732584194,p=271733878;for(d=0;d<a.length;d+=16)i=m,j=n,k=o,l=p,m=e(m,n,o,p,a[d],7,-680876936),p=e(p,m,n,o,a[d+1],12,-389564586),o=e(o,p,m,n,a[d+2],17,606105819),n=e(n,o,p,m,a[d+3],22,-1044525330),m=e(m,n,o,p,a[d+4],7,-176418897),p=e(p,m,n,o,a[d+5],12,1200080426),o=e(o,p,m,n,a[d+6],17,-1473231341),n=e(n,o,p,m,a[d+7],22,-45705983),m=e(m,n,o,p,a[d+8],7,1770035416),p=e(p,m,n,o,a[d+9],12,-1958414417),o=e(o,p,m,n,a[d+10],17,-42063),n=e(n,o,p,m,a[d+11],22,-1990404162),m=e(m,n,o,p,a[d+12],7,1804603682),p=e(p,m,n,o,a[d+13],12,-40341101),o=e(o,p,m,n,a[d+14],17,-1502002290),n=e(n,o,p,m,a[d+15],22,1236535329),m=f(m,n,o,p,a[d+1],5,-165796510),p=f(p,m,n,o,a[d+6],9,-1069501632),o=f(o,p,m,n,a[d+11],14,643717713),n=f(n,o,p,m,a[d],20,-373897302),m=f(m,n,o,p,a[d+5],5,-701558691),p=f(p,m,n,o,a[d+10],9,38016083),o=f(o,p,m,n,a[d+15],14,-660478335),n=f(n,o,p,m,a[d+4],20,-405537848),m=f(m,n,o,p,a[d+9],5,568446438),p=f(p,m,n,o,a[d+14],9,-1019803690),o=f(o,p,m,n,a[d+3],14,-187363961),n=f(n,o,p,m,a[d+8],20,1163531501),m=f(m,n,o,p,a[d+13],5,-1444681467),p=f(p,m,n,o,a[d+2],9,-51403784),o=f(o,p,m,n,a[d+7],14,1735328473),n=f(n,o,p,m,a[d+12],20,-1926607734),m=g(m,n,o,p,a[d+5],4,-378558),p=g(p,m,n,o,a[d+8],11,-2022574463),o=g(o,p,m,n,a[d+11],16,1839030562),n=g(n,o,p,m,a[d+14],23,-35309556),m=g(m,n,o,p,a[d+1],4,-1530992060),p=g(p,m,n,o,a[d+4],11,1272893353),o=g(o,p,m,n,a[d+7],16,-155497632),n=g(n,o,p,m,a[d+10],23,-1094730640),m=g(m,n,o,p,a[d+13],4,681279174),p=g(p,m,n,o,a[d],11,-358537222),o=g(o,p,m,n,a[d+3],16,-722521979),n=g(n,o,p,m,a[d+6],23,76029189),m=g(m,n,o,p,a[d+9],4,-640364487),p=g(p,m,n,o,a[d+12],11,-421815835),o=g(o,p,m,n,a[d+15],16,530742520),n=g(n,o,p,m,a[d+2],23,-995338651),m=h(m,n,o,p,a[d],6,-198630844),p=h(p,m,n,o,a[d+7],10,1126891415),o=h(o,p,m,n,a[d+14],15,-1416354905),n=h(n,o,p,m,a[d+5],21,-57434055),m=h(m,n,o,p,a[d+12],6,1700485571),p=h(p,m,n,o,a[d+3],10,-1894986606),o=h(o,p,m,n,a[d+10],15,-1051523),n=h(n,o,p,m,a[d+1],21,-2054922799),m=h(m,n,o,p,a[d+8],6,1873313359),p=h(p,m,n,o,a[d+15],10,-30611744),o=h(o,p,m,n,a[d+6],15,-1560198380),n=h(n,o,p,m,a[d+13],21,1309151649),m=h(m,n,o,p,a[d+4],6,-145523070),p=h(p,m,n,o,a[d+11],10,-1120210379),o=h(o,p,m,n,a[d+2],15,718787259),n=h(n,o,p,m,a[d+9],21,-343485551),m=b(m,i),n=b(n,j),o=b(o,k),p=b(p,l);return[m,n,o,p]}function j(a){var b,c="";for(b=0;b<32*a.length;b+=8)c+=String.fromCharCode(a[b>>5]>>>b%32&255);return c}function k(a){var b,c=[];for(c[(a.length>>2)-1]=void 0,b=0;b<c.length;b+=1)c[b]=0;for(b=0;b<8*a.length;b+=8)c[b>>5]|=(255&a.charCodeAt(b/8))<<b%32;return c}function l(a){return j(i(k(a),8*a.length))}function m(a,b){var c,d,e=k(a),f=[],g=[];for(f[15]=g[15]=void 0,e.length>16&&(e=i(e,8*a.length)),c=0;16>c;c+=1)f[c]=909522486^e[c],g[c]=1549556828^e[c];return d=i(f.concat(k(b)),512+8*b.length),j(i(g.concat(d),640))}function n(a){var b,c,d="0123456789abcdef",e="";for(c=0;c<a.length;c+=1)b=a.charCodeAt(c),e+=d.charAt(b>>>4&15)+d.charAt(15&b);return e}function o(a){return unescape(encodeURIComponent(a))}function p(a){return l(o(a))}function q(a){return n(p(a))}function r(a,b){return m(o(a),o(b))}function s(a,b){return n(r(a,b))}function t(a,b,c){return b?c?r(b,a):s(b,a):c?p(a):q(a)}"function"==typeof define&&define.amd?define(function(){return t}):a.md5=t}(this);

// Array Remove - By John Resig (MIT Licensed)
Array.prototype.remove=function(t,h){var e=this.slice((h||t)+1||this.length);return this.length=0>t?this.length+t:t,this.push.apply(this,e)};

// Stanford Javascript Crypto Library (1.0.4)
"use strict";function q(a){throw a;}var s=void 0,u=!1;var sjcl={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(a){this.toString=function(){return"CORRUPT: "+this.message};this.message=a},invalid:function(a){this.toString=function(){return"INVALID: "+this.message};this.message=a},bug:function(a){this.toString=function(){return"BUG: "+this.message};this.message=a},notReady:function(a){this.toString=function(){return"NOT READY: "+this.message};this.message=a}}};"undefined"!==typeof module&&module.exports&&(module.exports=sjcl);"function"===typeof define&&define([],function(){return sjcl});sjcl.cipher.aes=function(a){this.l[0][0][0]||this.G();var b,c,d,e,g=this.l[0][4],f=this.l[1];b=a.length;var h=1;4!==b&&(6!==b&&8!==b)&&q(new sjcl.exception.invalid("invalid aes key size"));this.b=[d=a.slice(0),e=[]];for(a=b;a<4*b+28;a++){c=d[a-1];if(0===a%b||8===b&&4===a%b)c=g[c>>>24]<<24^g[c>>16&255]<<16^g[c>>8&255]<<8^g[c&255],0===a%b&&(c=c<<8^c>>>24^h<<24,h=h<<1^283*(h>>7));d[a]=d[a-b]^c}for(b=0;a;b++,a--)c=d[b&3?a:a-4],e[b]=4>=a||4>b?c:f[0][g[c>>>24]]^f[1][g[c>>16&255]]^f[2][g[c>>8&255]]^f[3][g[c&255]]};sjcl.cipher.aes.prototype={encrypt:function(a){return w(this,a,0)},decrypt:function(a){return w(this,a,1)},l:[[[],[],[],[],[]],[[],[],[],[],[]]],G:function(){var a=this.l[0],b=this.l[1],c=a[4],d=b[4],e,g,f,h=[],l=[],k,m,n,p;for(e=0;0x100>e;e++)l[(h[e]=e<<1^283*(e>>7))^e]=e;for(g=f=0;!c[g];g^=k||1,f=l[f]||1){n=f^f<<1^f<<2^f<<3^f<<4;n=n>>8^n&255^99;c[g]=n;d[n]=g;m=h[e=h[k=h[g]]];p=0x1010101*m^0x10001*e^0x101*k^0x1010100*g;m=0x101*h[n]^0x1010100*n;for(e=0;4>e;e++)a[e][g]=m=m<<24^m>>>8,b[e][n]=p=p<<24^p>>>8}for(e=0;5>e;e++)a[e]=a[e].slice(0),b[e]=b[e].slice(0)}};function w(a,b,c){4!==b.length&&q(new sjcl.exception.invalid("invalid aes block size"));var d=a.b[c],e=b[0]^d[0],g=b[c?3:1]^d[1],f=b[2]^d[2];b=b[c?1:3]^d[3];var h,l,k,m=d.length/4-2,n,p=4,t=[0,0,0,0];h=a.l[c];a=h[0];var r=h[1],v=h[2],y=h[3],z=h[4];for(n=0;n<m;n++)h=a[e>>>24]^r[g>>16&255]^v[f>>8&255]^y[b&255]^d[p],l=a[g>>>24]^r[f>>16&255]^v[b>>8&255]^y[e&255]^d[p+1],k=a[f>>>24]^r[b>>16&255]^v[e>>8&255]^y[g&255]^d[p+2],b=a[b>>>24]^r[e>>16&255]^v[g>>8&255]^y[f&255]^d[p+3],p+=4,e=h,g=l,f=k;for(n=0;4>n;n++)t[c?3&-n:n]=z[e>>>24]<<24^z[g>>16&255]<<16^z[f>>8&255]<<8^z[b&255]^d[p++],h=e,e=g,g=f,f=b,b=h;return t}sjcl.bitArray={bitSlice:function(a,b,c){a=sjcl.bitArray.R(a.slice(b/32),32-(b&31)).slice(1);return c===s?a:sjcl.bitArray.clamp(a,c-b)},extract:function(a,b,c){var d=Math.floor(-b-c&31);return((b+c-1^b)&-32?a[b/32|0]<<32-d^a[b/32+1|0]>>>d:a[b/32|0]>>>d)&(1<<c)-1},concat:function(a,b){if(0===a.length||0===b.length)return a.concat(b);var c=a[a.length-1],d=sjcl.bitArray.getPartial(c);return 32===d?a.concat(b):sjcl.bitArray.R(b,d,c|0,a.slice(0,a.length-1))},bitLength:function(a){var b=a.length;return 0===b?0:32*(b-1)+sjcl.bitArray.getPartial(a[b-1])},clamp:function(a,b){if(32*a.length<b)return a;a=a.slice(0,Math.ceil(b/32));var c=a.length;b&=31;0<c&&b&&(a[c-1]=sjcl.bitArray.partial(b,a[c-1]&2147483648>>b-1,1));return a},partial:function(a,b,c){return 32===a?b:(c?b|0:b<<32-a)+0x10000000000*a},getPartial:function(a){return Math.round(a/0x10000000000)||32},equal:function(a,b){if(sjcl.bitArray.bitLength(a)!==sjcl.bitArray.bitLength(b))return u;var c=0,d;for(d=0;d<a.length;d++)c|=a[d]^b[d];return 0===c},R:function(a,b,c,d){var e;e=0;for(d===s&&(d=[]);32<=b;b-=32)d.push(c),c=0;if(0===b)return d.concat(a);for(e=0;e<a.length;e++)d.push(c|a[e]>>>b),c=a[e]<<32-b;e=a.length?a[a.length-1]:0;a=sjcl.bitArray.getPartial(e);d.push(sjcl.bitArray.partial(b+a&31,32<b+a?c:d.pop(),1));return d},g:function(a,b){return[a[0]^b[0],a[1]^b[1],a[2]^b[2],a[3]^b[3]]},byteswapM:function(a){var b,c;for(b=0;b<a.length;++b)c=a[b],a[b]=c>>>24|c>>>8&0xff00|(c&0xff00)<<8|c<<24;return a}};sjcl.codec.utf8String={fromBits:function(a){var b="",c=sjcl.bitArray.bitLength(a),d,e;for(d=0;d<c/8;d++)0===(d&3)&&(e=a[d/4]),b+=String.fromCharCode(e>>>24),e<<=8;return decodeURIComponent(escape(b))},toBits:function(a){a=unescape(encodeURIComponent(a));var b=[],c,d=0;for(c=0;c<a.length;c++)d=d<<8|a.charCodeAt(c),3===(c&3)&&(b.push(d),d=0);c&3&&b.push(sjcl.bitArray.partial(8*(c&3),d));return b}};sjcl.codec.hex={fromBits:function(a){var b="",c;for(c=0;c<a.length;c++)b+=((a[c]|0)+0xf00000000000).toString(16).substr(4);return b.substr(0,sjcl.bitArray.bitLength(a)/4)},toBits:function(a){var b,c=[],d;a=a.replace(/\s|0x/g,"");d=a.length;a+="00000000";for(b=0;b<a.length;b+=8)c.push(parseInt(a.substr(b,8),16)^0);return sjcl.bitArray.clamp(c,4*d)}};sjcl.codec.base32={p:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",O:"0123456789ABCDEFGHIJKLMNOPQRSTUV",BITS:32,BASE:5,REMAINING:27,fromBits:function(a,b,c){var d=sjcl.codec.base32.BASE,e=sjcl.codec.base32.REMAINING,g="",f=0,h=sjcl.codec.base32.p,l=0,k=sjcl.bitArray.bitLength(a);c&&(h=sjcl.codec.base32.O);for(c=0;g.length*d<k;)g+=h.charAt((l^a[c]>>>f)>>>e),f<d?(l=a[c]<<d-f,f+=e,c++):(l<<=d,f-=d);for(;g.length&7&&!b;)g+="=";return g},toBits:function(a,b){a=a.replace(/\s|=/g,"").toUpperCase();var c=sjcl.codec.base32.BITS,d=sjcl.codec.base32.BASE,e=sjcl.codec.base32.REMAINING,g=[],f,h=0,l=sjcl.codec.base32.p,k=0,m,n="base32";b&&(l=sjcl.codec.base32.O,n="base32hex");for(f=0;f<a.length;f++){m=l.indexOf(a.charAt(f));if(0>m){if(!b)try{return sjcl.codec.base32hex.toBits(a)}catch(p){}q(new sjcl.exception.invalid("this isn't "+n+"!"))}h>e?(h-=e,g.push(k^m>>>h),k=m<<c-h):(h+=d,k^=m<<c-h)}h&56&&g.push(sjcl.bitArray.partial(h&56,k,1));return g}};sjcl.codec.base32hex={fromBits:function(a,b){return sjcl.codec.base32.fromBits(a,b,1)},toBits:function(a){return sjcl.codec.base32.toBits(a,1)}};sjcl.codec.base64={p:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(a,b,c){var d="",e=0,g=sjcl.codec.base64.p,f=0,h=sjcl.bitArray.bitLength(a);c&&(g=g.substr(0,62)+"-_");for(c=0;6*d.length<h;)d+=g.charAt((f^a[c]>>>e)>>>26),6>e?(f=a[c]<<6-e,e+=26,c++):(f<<=6,e-=6);for(;d.length&3&&!b;)d+="=";return d},toBits:function(a,b){a=a.replace(/\s|=/g,"");var c=[],d,e=0,g=sjcl.codec.base64.p,f=0,h;b&&(g=g.substr(0,62)+"-_");for(d=0;d<a.length;d++)h=g.indexOf(a.charAt(d)),0>h&&q(new sjcl.exception.invalid("this isn't base64!")),26<e?(e-=26,c.push(f^h>>>e),f=h<<32-e):(e+=6,f^=h<<32-e);e&56&&c.push(sjcl.bitArray.partial(e&56,f,1));return c}};sjcl.codec.base64url={fromBits:function(a){return sjcl.codec.base64.fromBits(a,1,1)},toBits:function(a){return sjcl.codec.base64.toBits(a,1)}};sjcl.hash.sha256=function(a){this.b[0]||this.G();a?(this.s=a.s.slice(0),this.o=a.o.slice(0),this.i=a.i):this.reset()};sjcl.hash.sha256.hash=function(a){return(new sjcl.hash.sha256).update(a).finalize()};sjcl.hash.sha256.prototype={blockSize:512,reset:function(){this.s=this.P.slice(0);this.o=[];this.i=0;return this},update:function(a){"string"===typeof a&&(a=sjcl.codec.utf8String.toBits(a));var b,c=this.o=sjcl.bitArray.concat(this.o,a);b=this.i;a=this.i=b+sjcl.bitArray.bitLength(a);for(b=512+b&-512;b<=a;b+=512)x(this,c.splice(0,16));return this},finalize:function(){var a,b=this.o,c=this.s,b=sjcl.bitArray.concat(b,[sjcl.bitArray.partial(1,1)]);for(a=b.length+2;a&15;a++)b.push(0);b.push(Math.floor(this.i/4294967296));for(b.push(this.i|0);b.length;)x(this,b.splice(0,16));this.reset();return c},P:[],b:[],G:function(){function a(a){return 0x100000000*(a-Math.floor(a))|0}var b=0,c=2,d;a:for(;64>b;c++){for(d=2;d*d<=c;d++)if(0===c%d)continue a;8>b&&(this.P[b]=a(Math.pow(c,0.5)));this.b[b]=a(Math.pow(c,1/3));b++}}};function x(a,b){var c,d,e,g=b.slice(0),f=a.s,h=a.b,l=f[0],k=f[1],m=f[2],n=f[3],p=f[4],t=f[5],r=f[6],v=f[7];for(c=0;64>c;c++)16>c?d=g[c]:(d=g[c+1&15],e=g[c+14&15],d=g[c&15]=(d>>>7^d>>>18^d>>>3^d<<25^d<<14)+(e>>>17^e>>>19^e>>>10^e<<15^e<<13)+g[c&15]+g[c+9&15]|0),d=d+v+(p>>>6^p>>>11^p>>>25^p<<26^p<<21^p<<7)+(r^p&(t^r))+h[c],v=r,r=t,t=p,p=n+d|0,n=m,m=k,k=l,l=d+(k&m^n&(k^m))+(k>>>2^k>>>13^k>>>22^k<<30^k<<19^k<<10)|0;f[0]=f[0]+l|0;f[1]=f[1]+k|0;f[2]=f[2]+m|0;f[3]=f[3]+n|0;f[4]=f[4]+p|0;f[5]=f[5]+t|0;f[6]=f[6]+r|0;f[7]=f[7]+v|0}sjcl.mode.ccm={name:"ccm",t:[],listenProgress:function(a){sjcl.mode.ccm.t.push(a)},unListenProgress:function(a){a=sjcl.mode.ccm.t.indexOf(a);-1<a&&sjcl.mode.ccm.t.splice(a,1)},X:function(a){var b=sjcl.mode.ccm.t.slice(),c;for(c=0;c<b.length;c+=1)b[c](a)},encrypt:function(a,b,c,d,e){var g,f=b.slice(0),h=sjcl.bitArray,l=h.bitLength(c)/8,k=h.bitLength(f)/8;e=e||64;d=d||[];7>l&&q(new sjcl.exception.invalid("ccm: iv must be at least 7 bytes"));for(g=2;4>g&&k>>>8*g;g++);g<15-l&&(g=15-l);c=h.clamp(c,8*(15-g));b=sjcl.mode.ccm.M(a,b,c,d,e,g);f=sjcl.mode.ccm.q(a,f,c,b,e,g);return h.concat(f.data,f.tag)},decrypt:function(a,b,c,d,e){e=e||64;d=d||[];var g=sjcl.bitArray,f=g.bitLength(c)/8,h=g.bitLength(b),l=g.clamp(b,h-e),k=g.bitSlice(b,h-e),h=(h-e)/8;7>f&&q(new sjcl.exception.invalid("ccm: iv must be at least 7 bytes"));for(b=2;4>b&&h>>>8*b;b++);b<15-f&&(b=15-f);c=g.clamp(c,8*(15-b));l=sjcl.mode.ccm.q(a,l,c,k,e,b);a=sjcl.mode.ccm.M(a,l.data,c,d,e,b);g.equal(l.tag,a)||q(new sjcl.exception.corrupt("ccm: tag doesn't match"));return l.data},ea:function(a,b,c,d,e,g){var f=[],h=sjcl.bitArray,l=h.g;d=[h.partial(8,(b.length?64:0)|d-2<<2|g-1)];d=h.concat(d,c);d[3]|=e;d=a.encrypt(d);if(b.length){c=h.bitLength(b)/8;65279>=c?f=[h.partial(16,c)]:0xffffffff>=c&&(f=h.concat([h.partial(16,65534)],[c]));f=h.concat(f,b);for(b=0;b<f.length;b+=4)d=a.encrypt(l(d,f.slice(b,b+4).concat([0,0,0])))}return d},M:function(a,b,c,d,e,g){var f=sjcl.bitArray,h=f.g;e/=8;(e%2||4>e||16<e)&&q(new sjcl.exception.invalid("ccm: invalid tag length"));(0xffffffff<d.length||0xffffffff<b.length)&&q(new sjcl.exception.bug("ccm: can't deal with 4GiB or more data"));c=sjcl.mode.ccm.ea(a,d,c,e,f.bitLength(b)/8,g);for(d=0;d<b.length;d+=4)c=a.encrypt(h(c,b.slice(d,d+4).concat([0,0,0])));return f.clamp(c,8*e)},q:function(a,b,c,d,e,g){var f,h=sjcl.bitArray;f=h.g;var l=b.length,k=h.bitLength(b),m=l/50,n=m;c=h.concat([h.partial(8,g-1)],c).concat([0,0,0]).slice(0,4);d=h.bitSlice(f(d,a.encrypt(c)),0,e);if(!l)return{tag:d,data:[]};for(f=0;f<l;f+=4)f>m&&(sjcl.mode.ccm.X(f/l),m+=n),c[3]++,e=a.encrypt(c),b[f]^=e[0],b[f+1]^=e[1],b[f+2]^=e[2],b[f+3]^=e[3];return{tag:d,data:h.clamp(b,k)}}};sjcl.mode.ocb2={name:"ocb2",encrypt:function(a,b,c,d,e,g){128!==sjcl.bitArray.bitLength(c)&&q(new sjcl.exception.invalid("ocb iv must be 128 bits"));var f,h=sjcl.mode.ocb2.J,l=sjcl.bitArray,k=l.g,m=[0,0,0,0];c=h(a.encrypt(c));var n,p=[];d=d||[];e=e||64;for(f=0;f+4<b.length;f+=4)n=b.slice(f,f+4),m=k(m,n),p=p.concat(k(c,a.encrypt(k(c,n)))),c=h(c);n=b.slice(f);b=l.bitLength(n);f=a.encrypt(k(c,[0,0,0,b]));n=l.clamp(k(n.concat([0,0,0]),f),b);m=k(m,k(n.concat([0,0,0]),f));m=a.encrypt(k(m,k(c,h(c))));d.length&&(m=k(m,g?d:sjcl.mode.ocb2.pmac(a,d)));return p.concat(l.concat(n,l.clamp(m,e)))},decrypt:function(a,b,c,d,e,g){128!==sjcl.bitArray.bitLength(c)&&q(new sjcl.exception.invalid("ocb iv must be 128 bits"));e=e||64;var f=sjcl.mode.ocb2.J,h=sjcl.bitArray,l=h.g,k=[0,0,0,0],m=f(a.encrypt(c)),n,p,t=sjcl.bitArray.bitLength(b)-e,r=[];d=d||[];for(c=0;c+4<t/32;c+=4)n=l(m,a.decrypt(l(m,b.slice(c,c+4)))),k=l(k,n),r=r.concat(n),m=f(m);p=t-32*c;n=a.encrypt(l(m,[0,0,0,p]));n=l(n,h.clamp(b.slice(c),p).concat([0,0,0]));k=l(k,n);k=a.encrypt(l(k,l(m,f(m))));d.length&&(k=l(k,g?d:sjcl.mode.ocb2.pmac(a,d)));h.equal(h.clamp(k,e),h.bitSlice(b,t))||q(new sjcl.exception.corrupt("ocb: tag doesn't match"));return r.concat(h.clamp(n,p))},pmac:function(a,b){var c,d=sjcl.mode.ocb2.J,e=sjcl.bitArray,g=e.g,f=[0,0,0,0],h=a.encrypt([0,0,0,0]),h=g(h,d(d(h)));for(c=0;c+4<b.length;c+=4)h=d(h),f=g(f,a.encrypt(g(h,b.slice(c,c+4))));c=b.slice(c);128>e.bitLength(c)&&(h=g(h,d(h)),c=e.concat(c,[-2147483648,0,0,0]));f=g(f,c);return a.encrypt(g(d(g(h,d(h))),f))},J:function(a){return[a[0]<<1^a[1]>>>31,a[1]<<1^a[2]>>>31,a[2]<<1^a[3]>>>31,a[3]<<1^135*(a[0]>>>31)]}};sjcl.mode.gcm={name:"gcm",encrypt:function(a,b,c,d,e){var g=b.slice(0);b=sjcl.bitArray;d=d||[];a=sjcl.mode.gcm.q(!0,a,g,d,c,e||128);return b.concat(a.data,a.tag)},decrypt:function(a,b,c,d,e){var g=b.slice(0),f=sjcl.bitArray,h=f.bitLength(g);e=e||128;d=d||[];e<=h?(b=f.bitSlice(g,h-e),g=f.bitSlice(g,0,h-e)):(b=g,g=[]);a=sjcl.mode.gcm.q(u,a,g,d,c,e);f.equal(a.tag,b)||q(new sjcl.exception.corrupt("gcm: tag doesn't match"));return a.data},ba:function(a,b){var c,d,e,g,f,h=sjcl.bitArray.g;e=[0,0,0,0];g=b.slice(0);for(c=0;128>c;c++){(d=0!==(a[Math.floor(c/32)]&1<<31-c%32))&&(e=h(e,g));f=0!==(g[3]&1);for(d=3;0<d;d--)g[d]=g[d]>>>1|(g[d-1]&1)<<31;g[0]>>>=1;f&&(g[0]^=-0x1f000000)}return e},h:function(a,b,c){var d,e=c.length;b=b.slice(0);for(d=0;d<e;d+=4)b[0]^=0xffffffff&c[d],b[1]^=0xffffffff&c[d+1],b[2]^=0xffffffff&c[d+2],b[3]^=0xffffffff&c[d+3],b=sjcl.mode.gcm.ba(b,a);return b},q:function(a,b,c,d,e,g){var f,h,l,k,m,n,p,t,r=sjcl.bitArray;n=c.length;p=r.bitLength(c);t=r.bitLength(d);h=r.bitLength(e);f=b.encrypt([0,0,0,0]);96===h?(e=e.slice(0),e=r.concat(e,[1])):(e=sjcl.mode.gcm.h(f,[0,0,0,0],e),e=sjcl.mode.gcm.h(f,e,[0,0,Math.floor(h/0x100000000),h&0xffffffff]));h=sjcl.mode.gcm.h(f,[0,0,0,0],d);m=e.slice(0);d=h.slice(0);a||(d=sjcl.mode.gcm.h(f,h,c));for(k=0;k<n;k+=4)m[3]++,l=b.encrypt(m),c[k]^=l[0],c[k+1]^=l[1],c[k+2]^=l[2],c[k+3]^=l[3];c=r.clamp(c,p);a&&(d=sjcl.mode.gcm.h(f,h,c));a=[Math.floor(t/0x100000000),t&0xffffffff,Math.floor(p/0x100000000),p&0xffffffff];d=sjcl.mode.gcm.h(f,d,a);l=b.encrypt(e);d[0]^=l[0];d[1]^=l[1];d[2]^=l[2];d[3]^=l[3];return{tag:r.bitSlice(d,0,g),data:c}}};sjcl.misc.hmac=function(a,b){this.N=b=b||sjcl.hash.sha256;var c=[[],[]],d,e=b.prototype.blockSize/32;this.n=[new b,new b];a.length>e&&(a=b.hash(a));for(d=0;d<e;d++)c[0][d]=a[d]^909522486,c[1][d]=a[d]^1549556828;this.n[0].update(c[0]);this.n[1].update(c[1]);this.I=new b(this.n[0])};sjcl.misc.hmac.prototype.encrypt=sjcl.misc.hmac.prototype.mac=function(a){this.S&&q(new sjcl.exception.invalid("encrypt on already updated hmac called!"));this.update(a);return this.digest(a)};sjcl.misc.hmac.prototype.reset=function(){this.I=new this.N(this.n[0]);this.S=u};sjcl.misc.hmac.prototype.update=function(a){this.S=!0;this.I.update(a)};sjcl.misc.hmac.prototype.digest=function(){var a=this.I.finalize(),a=(new this.N(this.n[1])).update(a).finalize();this.reset();return a};sjcl.misc.pbkdf2=function(a,b,c,d,e){c=c||1E3;(0>d||0>c)&&q(sjcl.exception.invalid("invalid params to pbkdf2"));"string"===typeof a&&(a=sjcl.codec.utf8String.toBits(a));"string"===typeof b&&(b=sjcl.codec.utf8String.toBits(b));e=e||sjcl.misc.hmac;a=new e(a);var g,f,h,l,k=[],m=sjcl.bitArray;for(l=1;32*k.length<(d||1);l++){e=g=a.encrypt(m.concat(b,[l]));for(f=1;f<c;f++){g=a.encrypt(g);for(h=0;h<g.length;h++)e[h]^=g[h]}k=k.concat(e)}d&&(k=m.clamp(k,d));return k};sjcl.prng=function(a){this.c=[new sjcl.hash.sha256];this.j=[0];this.H=0;this.u={};this.F=0;this.L={};this.Q=this.d=this.k=this.Z=0;this.b=[0,0,0,0,0,0,0,0];this.f=[0,0,0,0];this.C=s;this.D=a;this.r=u;this.B={progress:{},seeded:{}};this.m=this.Y=0;this.w=1;this.A=2;this.U=0x10000;this.K=[0,48,64,96,128,192,0x100,384,512,768,1024];this.V=3E4;this.T=80};sjcl.prng.prototype={randomWords:function(a,b){var c=[],d;d=this.isReady(b);var e;d===this.m&&q(new sjcl.exception.notReady("generator isn't seeded"));if(d&this.A){d=!(d&this.w);e=[];var g=0,f;this.Q=e[0]=(new Date).valueOf()+this.V;for(f=0;16>f;f++)e.push(0x100000000*Math.random()|0);for(f=0;f<this.c.length&&!(e=e.concat(this.c[f].finalize()),g+=this.j[f],this.j[f]=0,!d&&this.H&1<<f);f++);this.H>=1<<this.c.length&&(this.c.push(new sjcl.hash.sha256),this.j.push(0));this.d-=g;g>this.k&&(this.k=g);this.H++;this.b=sjcl.hash.sha256.hash(this.b.concat(e));this.C=new sjcl.cipher.aes(this.b);for(d=0;4>d&&!(this.f[d]=this.f[d]+1|0,this.f[d]);d++);}for(d=0;d<a;d+=4)0===(d+1)%this.U&&A(this),e=B(this),c.push(e[0],e[1],e[2],e[3]);A(this);return c.slice(0,a)},setDefaultParanoia:function(a,b){0===a&&"Setting paranoia=0 will ruin your security; use it only for testing"!==b&&q("Setting paranoia=0 will ruin your security; use it only for testing");this.D=a},addEntropy:function(a,b,c){c=c||"user";var d,e,g=(new Date).valueOf(),f=this.u[c],h=this.isReady(),l=0;d=this.L[c];d===s&&(d=this.L[c]=this.Z++);f===s&&(f=this.u[c]=0);this.u[c]=(this.u[c]+1)%this.c.length;switch(typeof a){case "number":b===s&&(b=1);this.c[f].update([d,this.F++,1,b,g,1,a|0]);break;case "object":c=Object.prototype.toString.call(a);if("[object Uint32Array]"===c){e=[];for(c=0;c<a.length;c++)e.push(a[c]);a=e}else{"[object Array]"!==c&&(l=1);for(c=0;c<a.length&&!l;c++)"number"!==typeof a[c]&&(l=1)}if(!l){if(b===s)for(c=b=0;c<a.length;c++)for(e=a[c];0<e;)b++,e>>>=1;this.c[f].update([d,this.F++,2,b,g,a.length].concat(a))}break;case "string":b===s&&(b=a.length);this.c[f].update([d,this.F++,3,b,g,a.length]);this.c[f].update(a);break;default:l=1}l&&q(new sjcl.exception.bug("random: addEntropy only supports number, array of numbers or string"));this.j[f]+=b;this.d+=b;h===this.m&&(this.isReady()!==this.m&&C("seeded",Math.max(this.k,this.d)),C("progress",this.getProgress()))},isReady:function(a){a=this.K[a!==s?a:this.D];return this.k&&this.k>=a?this.j[0]>this.T&&(new Date).valueOf()>this.Q?this.A|this.w:this.w:this.d>=a?this.A|this.m:this.m},getProgress:function(a){a=this.K[a?a:this.D];return this.k>=a?1:this.d>a?1:this.d/a},startCollectors:function(){this.r||(this.a={loadTimeCollector:D(this,this.da),mouseCollector:D(this,this.fa),keyboardCollector:D(this,this.ca),accelerometerCollector:D(this,this.W),touchCollector:D(this,this.ha)},window.addEventListener?(window.addEventListener("load",this.a.loadTimeCollector,u),window.addEventListener("mousemove",this.a.mouseCollector,u),window.addEventListener("keypress",this.a.keyboardCollector,u),window.addEventListener("devicemotion",this.a.accelerometerCollector,u),window.addEventListener("touchmove",this.a.touchCollector,u)):document.attachEvent?(document.attachEvent("onload",this.a.loadTimeCollector),document.attachEvent("onmousemove",this.a.mouseCollector),document.attachEvent("keypress",this.a.keyboardCollector)):q(new sjcl.exception.bug("can't attach event")),this.r=!0)},stopCollectors:function(){this.r&&(window.removeEventListener?(window.removeEventListener("load",this.a.loadTimeCollector,u),window.removeEventListener("mousemove",this.a.mouseCollector,u),window.removeEventListener("keypress",this.a.keyboardCollector,u),window.removeEventListener("devicemotion",this.a.accelerometerCollector,u),window.removeEventListener("touchmove",this.a.touchCollector,u)):document.detachEvent&&(document.detachEvent("onload",this.a.loadTimeCollector),document.detachEvent("onmousemove",this.a.mouseCollector),document.detachEvent("keypress",this.a.keyboardCollector)),this.r=u)},addEventListener:function(a,b){this.B[a][this.Y++]=b},removeEventListener:function(a,b){var c,d,e=this.B[a],g=[];for(d in e)e.hasOwnProperty(d)&&e[d]===b&&g.push(d);for(c=0;c<g.length;c++)d=g[c],delete e[d]},ca:function(){E(1)},fa:function(a){var b,c;try{b=a.x||a.clientX||a.offsetX||0,c=a.y||a.clientY||a.offsetY||0}catch(d){c=b=0}0!=b&&0!=c&&sjcl.random.addEntropy([b,c],2,"mouse");E(0)},ha:function(a){a=a.touches[0]||a.changedTouches[0];sjcl.random.addEntropy([a.pageX||a.clientX,a.pageY||a.clientY],1,"touch");E(0)},da:function(){E(2)},W:function(a){a=a.accelerationIncludingGravity.x||a.accelerationIncludingGravity.y||a.accelerationIncludingGravity.z;if(window.orientation){var b=window.orientation;"number"===typeof b&&sjcl.random.addEntropy(b,1,"accelerometer")}a&&sjcl.random.addEntropy(a,2,"accelerometer");E(0)}};function C(a,b){var c,d=sjcl.random.B[a],e=[];for(c in d)d.hasOwnProperty(c)&&e.push(d[c]);for(c=0;c<e.length;c++)e[c](b)}function E(a){"undefined"!==typeof window&&window.performance&&"function"===typeof window.performance.now?sjcl.random.addEntropy(window.performance.now(),a,"loadtime"):sjcl.random.addEntropy((new Date).valueOf(),a,"loadtime")}function A(a){a.b=B(a).concat(B(a));a.C=new sjcl.cipher.aes(a.b)}function B(a){for(var b=0;4>b&&!(a.f[b]=a.f[b]+1|0,a.f[b]);b++);return a.C.encrypt(a.f)}function D(a,b){return function(){b.apply(a,arguments)}}sjcl.random=new sjcl.prng(6);a:try{var F,G,H,I;if(I="undefined"!==typeof module){var J;if(J=module.exports){var K;try{K=require("crypto")}catch(L){K=null}J=(G=K)&&G.randomBytes}I=J}if(I)F=G.randomBytes(128),F=new Uint32Array((new Uint8Array(F)).buffer),sjcl.random.addEntropy(F,1024,"crypto['randomBytes']");else if("undefined"!==typeof window&&"undefined"!==typeof Uint32Array){H=new Uint32Array(32);if(window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(H);else if(window.msCrypto&&window.msCrypto.getRandomValues)window.msCrypto.getRandomValues(H);else break a;sjcl.random.addEntropy(H,1024,"crypto['getRandomValues']")}}catch(M){"undefined"!==typeof window&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(M))}sjcl.json={defaults:{v:1,iter:1E3,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},aa:function(a,b,c,d){c=c||{};d=d||{};var e=sjcl.json,g=e.e({iv:sjcl.random.randomWords(4,0)},e.defaults),f;e.e(g,c);c=g.adata;"string"===typeof g.salt&&(g.salt=sjcl.codec.base64.toBits(g.salt));"string"===typeof g.iv&&(g.iv=sjcl.codec.base64.toBits(g.iv));(!sjcl.mode[g.mode]||!sjcl.cipher[g.cipher]||"string"===typeof a&&100>=g.iter||64!==g.ts&&96!==g.ts&&128!==g.ts||128!==g.ks&&192!==g.ks&&0x100!==g.ks||2>g.iv.length||4<g.iv.length)&&q(new sjcl.exception.invalid("json encrypt: invalid parameters"));"string"===typeof a?(f=sjcl.misc.cachedPbkdf2(a,g),a=f.key.slice(0,g.ks/32),g.salt=f.salt):sjcl.ecc&&a instanceof sjcl.ecc.elGamal.publicKey&&(f=a.kem(),g.kemtag=f.tag,a=f.key.slice(0,g.ks/32));"string"===typeof b&&(b=sjcl.codec.utf8String.toBits(b));"string"===typeof c&&(g.adata=c=sjcl.codec.utf8String.toBits(c));f=new sjcl.cipher[g.cipher](a);e.e(d,g);d.key=a;g.ct="ccm"===g.mode&&sjcl.arrayBuffer&&sjcl.arrayBuffer.ccm&&b instanceof ArrayBuffer?sjcl.arrayBuffer.ccm.encrypt(f,b,g.iv,c,g.ts):sjcl.mode[g.mode].encrypt(f,b,g.iv,c,g.ts);return g},encrypt:function(a,b,c,d){var e=sjcl.json,g=e.aa.apply(e,arguments);return e.encode(g)},$:function(a,b,c,d){c=c||{};d=d||{};var e=sjcl.json;b=e.e(e.e(e.e({},e.defaults),b),c,!0);var g,f;g=b.adata;"string"===typeof b.salt&&(b.salt=sjcl.codec.base64.toBits(b.salt));"string"===typeof b.iv&&(b.iv=sjcl.codec.base64.toBits(b.iv));(!sjcl.mode[b.mode]||!sjcl.cipher[b.cipher]||"string"===typeof a&&100>=b.iter||64!==b.ts&&96!==b.ts&&128!==b.ts||128!==b.ks&&192!==b.ks&&0x100!==b.ks||!b.iv||2>b.iv.length||4<b.iv.length)&&q(new sjcl.exception.invalid("json decrypt: invalid parameters"));"string"===typeof a?(f=sjcl.misc.cachedPbkdf2(a,b),a=f.key.slice(0,b.ks/32),b.salt=f.salt):sjcl.ecc&&a instanceof sjcl.ecc.elGamal.secretKey&&(a=a.unkem(sjcl.codec.base64.toBits(b.kemtag)).slice(0,b.ks/32));"string"===typeof g&&(g=sjcl.codec.utf8String.toBits(g));f=new sjcl.cipher[b.cipher](a);g="ccm"===b.mode&&sjcl.arrayBuffer&&sjcl.arrayBuffer.ccm&&b.ct instanceof ArrayBuffer?sjcl.arrayBuffer.ccm.decrypt(f,b.ct,b.iv,b.tag,g,b.ts):sjcl.mode[b.mode].decrypt(f,b.ct,b.iv,g,b.ts);e.e(d,b);d.key=a;return 1===c.raw?g:sjcl.codec.utf8String.fromBits(g)},decrypt:function(a,b,c,d){var e=sjcl.json;return e.$(a,e.decode(b),c,d)},encode:function(a){var b,c="{",d="";for(b in a)if(a.hasOwnProperty(b))switch(b.match(/^[a-z0-9]+$/i)||q(new sjcl.exception.invalid("json encode: invalid property name")),c+=d+'"'+b+'":',d=",",typeof a[b]){case "number":case "boolean":c+=a[b];break;case "string":c+='"'+escape(a[b])+'"';break;case "object":c+='"'+sjcl.codec.base64.fromBits(a[b],0)+'"';break;default:q(new sjcl.exception.bug("json encode: unsupported type"))}return c+"}"},decode:function(a){a=a.replace(/\s/g,"");a.match(/^\{.*\}$/)||q(new sjcl.exception.invalid("json decode: this isn't json!"));a=a.replace(/^\{|\}$/g,"").split(/,/);var b={},c,d;for(c=0;c<a.length;c++)(d=a[c].match(/^\s*(?:(["']?)([a-z][a-z0-9]*)\1)\s*:\s*(?:(-?\d+)|"([a-z0-9+\/%*_.@=\-]*)"|(true|false))$/i))||q(new sjcl.exception.invalid("json decode: this isn't json!")),null!=d[3]?b[d[2]]=parseInt(d[3],10):null!=d[4]?b[d[2]]=d[2].match(/^(ct|adata|salt|iv)$/)?sjcl.codec.base64.toBits(d[4]):unescape(d[4]):null!=d[5]&&(b[d[2]]="true"===d[5]);return b},e:function(a,b,c){a===s&&(a={});if(b===s)return a;for(var d in b)b.hasOwnProperty(d)&&(c&&(a[d]!==s&&a[d]!==b[d])&&q(new sjcl.exception.invalid("required parameter overridden")),a[d]=b[d]);return a},ja:function(a,b){var c={},d;for(d in a)a.hasOwnProperty(d)&&a[d]!==b[d]&&(c[d]=a[d]);return c},ia:function(a,b){var c={},d;for(d=0;d<b.length;d++)a[b[d]]!==s&&(c[b[d]]=a[b[d]]);return c}};sjcl.encrypt=sjcl.json.encrypt;sjcl.decrypt=sjcl.json.decrypt;sjcl.misc.ga={};sjcl.misc.cachedPbkdf2=function(a,b){var c=sjcl.misc.ga,d;b=b||{};d=b.iter||1E3;c=c[a]=c[a]||{};d=c[d]=c[d]||{firstSalt:b.salt&&b.salt.length?b.salt.slice(0):sjcl.random.randomWords(2,0)};c=b.salt===s?d.firstSalt:b.salt;d[c]=d[c]||sjcl.misc.pbkdf2(a,c,b.iter);return{key:d[c].slice(0),salt:c.slice(0)}};
